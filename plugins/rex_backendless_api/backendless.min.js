/*
 * ********************************************************************************************************************
 *  Backendless SDK for JavaScript. Version: 4.0.10
 *
 *  Copyright 2012-2017 BACKENDLESS.COM. All Rights Reserved.
 *
 *  NOTICE: All information contained herein is, and remains the property of Backendless.com and its suppliers,
 *  if any. The intellectual and technical concepts contained herein are proprietary to Backendless.com and its
 *  suppliers and may be covered by U.S. and Foreign Patents, patents in process, and are protected by trade secret
 *  or copyright law. Dissemination of this information or reproduction of this material is strictly forbidden
 *  unless prior written permission is obtained from Backendless.com.
 * ********************************************************************************************************************
 */
(function(e){var t=typeof self==="object"&&self.self===self&&self||typeof global==="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define([],function(){return t.Backendless=e(t)})}else if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t.Backendless=e(t)}else{t.Backendless=e(t)}})(function(root){"use strict";var DEVICE=null;var isBrowser=new Function("try {return this===window;}catch(e){ return false;}")();var WebSocket=null;var UIState=null;var localStorageName="localStorage";var previousBackendless=root.Backendless;var Backendless={},emptyFn=function(){};Backendless.serverURL="https://api.backendless.com";Backendless.noConflict=function(){root.Backendless=previousBackendless;return this};Backendless.XMLHttpRequest=typeof XMLHttpRequest!=="undefined"&&XMLHttpRequest;var browser=function(){var e="NodeJS";if(isBrowser){e=navigator.userAgent?navigator.userAgent.toLowerCase():"hybrid-app"}var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],n={browser:t[1]||"",version:t[2]||"0"},r={};if(n.browser){r[n.browser]=true;r.version=n.version}return r}();var getNow=function(){return(new Date).getTime()};Backendless.browser=browser;var Utils={isObject:function(e){return e===Object(e)},isString:function(e){return Object.prototype.toString.call(e).slice(8,-1)==="String"},isNumber:function(e){return Object.prototype.toString.call(e).slice(8,-1)==="Number"},isFunction:function(e){return Object.prototype.toString.call(e).slice(8,-1)==="Function"},isBoolean:function(e){return Object.prototype.toString.call(e).slice(8,-1)==="Boolean"},isDate:function(e){return Object.prototype.toString.call(e).slice(8,-1)==="Date"}};Utils.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e).slice(8,-1)==="Array"};Utils.castArray=function(e){if(Utils.isArray(e)){return e}return[e]};Utils.addEvent=function(e,t,n){if(t.addEventListener){t.addEventListener(e,n,false)}else if(t.attachEvent){t.attachEvent("on"+e,n)}else{t[e]=n}};Utils.isEmpty=function(e){if(e==null){return true}if(Utils.isArray(e)||Utils.isString(e)){return e.length===0}for(var t in e){if(e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null){return false}}return true};Utils.removeEvent=function(e,t){if(t.removeEventListener){t.removeEventListener(e,null,false)}else if(t.detachEvent){t.detachEvent("on"+e,null)}else{t[e]=null}};Utils.stringToBiteArray=function(e){var t=new ArrayBuffer(e.length);var n=new Uint8Array(t,0);for(var r=0;r<e.length;r++){n[r]=e.charCodeAt(r)&255}return n};Utils.onHttpRequestErrorHandler=function(e,t,n){return function(){var r="Unable to connect to the network";if(e.status>=400){r=n(e)}t(r)}};Utils.toQueryParams=function(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(n+"="+encodeURIComponent(e[n]))}}return t.join("&")};Utils.toUri=function(){var e="";var t;for(var n=0;n<arguments.length;n++){t=arguments[n];if(!t){continue}if(Utils.isArray(t)){e+=this.toUri.apply(this,t)}else if(Utils.isString(t)){e+="/";e+=encodeURIComponent(t)}}return e};Utils.tryParseJSON=function(e){try{return typeof e==="string"?JSON.parse(e):e}catch(t){return e}};Utils.getClassName=function(e){if(e.prototype&&e.prototype.___class){return e.prototype.___class}if(Utils.isFunction(e)&&e.name){return e.name}var t=Utils.isFunction(e)?e.toString():e.constructor.toString(),n=t.match(/function\s+(\w+)/);return n&&n.length>1?n[1]:""};Utils.encodeArrayToUriComponent=function(e){var t=[],n,r;for(n=0,r=e.length;n<r;++n){t.push(encodeURIComponent(e[n]))}return t.join(",")};Utils.classWrapper=function(obj){var wrapper=function(obj){var wrapperName=null,Wrapper=null;for(var property in obj){if(obj.hasOwnProperty(property)){if(property==="___class"){wrapperName=obj[property];break}}}if(wrapperName){try{Wrapper=eval(wrapperName);obj=Utils.deepExtend(new Wrapper,obj)}catch(e){}}return obj};if(Utils.isObject(obj)&&obj!=null){if(Utils.isArray(obj)){for(var i=obj.length;i--;){obj[i]=wrapper(obj[i])}}else{obj=wrapper(obj)}}return obj};Utils.deepExtend=function(e,t){for(var n in t){if(t[n]!==undefined&&t.hasOwnProperty(n)){e[n]=e[n]||{};e[n]=Utils.classWrapper(t[n]);if(e[n]&&e[n].hasOwnProperty(n)&&e[n][n]&&e[n][n].hasOwnProperty("__originSubID")){e[n][n]=Utils.classWrapper(e[n])}}}return e};Utils.cloneObject=function(e){return Utils.isArray(e)?e.slice():Utils.deepExtend({},e)};Utils.extractResponder=function(e){var t,n;for(t=0,n=e.length;t<n;++t){if(e[t]instanceof Async){return e[t]}}return null};Utils.wrapAsync=function(e,t,n){var r=function(r){if(t){r=t.call(n,r)}e.success(r)};var i=function(t){e.fault(t)};return new Async(r,i)};Backendless.setUIState=function(e){if(e===undefined){throw new Error("UI state name must be defined or explicitly set to null")}else{UIState=e===null?null:e}};Backendless._ajax_for_browser=function(e){var t=["cacheOnly","remoteDataOnly","fromCacheOrRemote","fromRemoteOrCache","fromCacheAndRemote"],n={ignoreCache:function(e){return r(e)},cacheOnly:function(e){var t=Backendless.LocalCache.get(e.url.replace(/([^A-Za-z0-9])/g,"")),n={message:"error: cannot find data in Backendless.LocalCache",statusCode:404};if(t){e.isAsync&&e.asyncHandler.success(t);return t}else{if(e.isAsync){e.asyncHandler.fault(n)}else{throw n}}},remoteDataOnly:function(e){return r(e)},fromCacheOrRemote:function(e){var t=Backendless.LocalCache.get(e.url.replace(/([^A-Za-z0-9])/g,""));if(t){e.isAsync&&e.asyncHandler.success(t);return t}else{return r(e)}},fromRemoteOrCache:function(e){return r(e)},fromCacheAndRemote:function(e){var t={},n=Backendless.LocalCache.get(e.url.replace(/([^A-Za-z0-9])/g,"")),i={message:"error: cannot find data in Backendless.LocalCache",statusCode:404};t.remote=r(e);if(n){e.isAsync&&e.asyncHandler.success(n);t.local=n}else{if(e.isAsync){e.asyncHandler.fault(i)}else{throw i}}return t}},r=function(e){var t=new Backendless.XMLHttpRequest,n=e.data?"application/json":"application/x-www-form-urlencoded",r;var i=function(e){var t=true;if(e.responseText){t=Utils.tryParseJSON(e.responseText)}return t};var s=function(e){var t={};try{t=JSON.parse(e.responseText)}catch(n){t.message=e.responseText}t.statusCode=e.status;t.message=t.message||"unknown error occurred";return t};var a=function(t){t=Utils.cloneObject(t);if(e.method==="GET"&&e.cacheActive){t.cachePolicy=e.cachePolicy;Backendless.LocalCache.set(e.urlBlueprint,t)}else if(Backendless.LocalCache.exists(e.urlBlueprint)){if(t===true||e.method==="DELETE"){t=undefined}else{t.cachePolicy=Backendless.LocalCache.getCachePolicy(e.urlBlueprint)}"___class"in t&&delete t["___class"];Backendless.LocalCache.set(e.urlBlueprint,t)}};var o=function(){return e.cacheActive&&e.cachePolicy.policy==="fromRemoteOrCache"&&Backendless.LocalCache.exists(e.urlBlueprint)};t.open(e.method,e.url,e.isAsync);t.setRequestHeader("Content-Type",n);if(currentUser!=null&&currentUser["user-token"]){t.setRequestHeader("user-token",currentUser["user-token"])}else if(Backendless.LocalCache.exists("user-token")){t.setRequestHeader("user-token",Backendless.LocalCache.get("user-token"))}if(UIState!==null){t.setRequestHeader("uiState",UIState)}if(e.isAsync){t.onreadystatechange=function(){if(t.readyState===4&&t.status){if(t.status>=200&&t.status<300){r=i(t);a(r);e.asyncHandler.success&&e.asyncHandler.success(r)}else if(o()){e.asyncHandler.success&&e.asyncHandler.success(Backendless.LocalCache.get(e.urlBlueprint))}else{e.asyncHandler.fault&&e.asyncHandler.fault(s(t))}}};if(e.asyncHandler.fault){t.onerror=Utils.onHttpRequestErrorHandler(t,e.asyncHandler.fault,s)}}t.send(e.data);if(e.isAsync){return t}else if(t.status>=200&&t.status<300){r=i(t);a(r);return r}else if(o()){return Backendless.LocalCache.get(e.urlBlueprint)}else{throw s(t)}};e.method=e.method||"GET";e.cachePolicy=e.cachePolicy||{policy:"ignoreCache"};e.isAsync=typeof e.isAsync==="boolean"?e.isAsync:false;e.cacheActive=e.method==="GET"&&t.indexOf(e.cachePolicy.policy)!==-1;e.urlBlueprint=e.url.replace(/([^A-Za-z0-9])/g,"");try{return n[e.cachePolicy.policy].call(this,e)}catch(e){throw e}};Backendless._ajax_for_nodejs=function(e){e.data=e.data||"";e.asyncHandler=e.asyncHandler||{};e.isAsync=typeof e.isAsync==="boolean"?e.isAsync:false;if(!e.isAsync){throw new Error("Using the sync methods of the Backendless API in Node.js is disallowed. "+"Use the async methods instead.")}if(typeof e.data!=="string"){e.data=JSON.stringify(e.data)}var t=require("url").parse(e.url);var n=t.protocol==="https:";var r={host:t.hostname,port:t.port||(n?443:80),method:e.method||"GET",path:t.path,headers:{"Content-Length":e.data?Buffer.byteLength(e.data):0,"Content-Type":e.data?"application/json":"application/x-www-form-urlencoded"}};if(currentUser!=null&&!!currentUser["user-token"]){r.headers["user-token"]=currentUser["user-token"]}else if(Backendless.LocalCache.exists("user-token")){r.headers["user-token"]=Backendless.LocalCache.get("user-token")}var i;var s=require(n?"https":"http");var a=s.request(r,function(t){t.setEncoding("utf8");t.on("data",function(e){i=i?i+e:e});t.on("end",function(){var n=e.asyncHandler[t.statusCode>=200&&t.statusCode<300?"success":"fault"];if(Utils.isFunction(n)){var r=t.headers["content-type"];if(i!==undefined&&r){i=Utils.tryParseJSON(i)}n(i)}})});a.on("error",function(t){e.asyncHandler.fault&&e.asyncHandler.fault(t)});a.write(e.data);return a.end()};Backendless._ajax=function(e){return Backendless.XMLHttpRequest?Backendless._ajax_for_browser(e):Backendless._ajax_for_nodejs(e)};function Async(e,t,n){if(!(t instanceof Function)){n=t;t=emptyFn}this.success=function(t){e&&e.call(n,t)};this.fault=function(e){t&&t.call(n,e)}}function setCache(){var e={},t={};e.enabled=false;e.exists=function(t){return e.get(t)!==undefined};e.set=function(n,r){return t[n]=e.serialize(r)};e.get=function(n){var r=t[n];return r&&e.deserialize(r)};e.remove=function(e){return delete t[e]};e.clear=function(){t={}};e.flushExpired=function(){};e.getCachePolicy=function(e){};e.getAll=function(){var e={};for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}return e};e.serialize=function(e){return JSON.stringify(e)};e.deserialize=function(e){if(typeof e!=="string"){return undefined}try{return JSON.parse(e)}catch(t){return e||undefined}};function n(){try{if(isBrowser&&(localStorageName in window&&window[localStorageName])){localStorage.setItem("localStorageTest",true);localStorage.removeItem("localStorageTest");return true}else{return false}}catch(e){return false}}if(n()){return extendToLocalStorageCache(e)}return e}function extendToLocalStorageCache(e){var t=window[localStorageName];var n=function(){if(!t.getItem("Backendless")){t.setItem("Backendless",e.serialize({}))}};var r=function(e){var t=false;if(e&&Object.prototype.toString.call(e).slice(8,-1)==="Object"){if("cachePolicy"in e&&"timeToLive"in e.cachePolicy&&e.cachePolicy.timeToLive!==-1&&"created"in e.cachePolicy){t=(new Date).getTime()-e["cachePolicy"]["created"]>e["cachePolicy"]["timeToLive"]}}return t};var i=function(e){if(e&&Object.prototype.toString.call(e).slice(8,-1)==="Object"){if("cachePolicy"in e&&"timeToLive"in e["cachePolicy"]){e["cachePolicy"]["created"]=(new Date).getTime()}}};n();e.enabled=true;e.exists=function(t){return e.get(t)!==undefined};e.set=function(r,s){if(s===undefined){return e.remove(r)}n();var a=e.deserialize(t.getItem("Backendless"));i(s);a[r]=s;try{t.setItem("Backendless",e.serialize(a))}catch(n){a={};a[r]=s;t.setItem("Backendless",e.serialize(a))}return s};e.get=function(i){n();var s=e.deserialize(t.getItem("Backendless")),a=s[i],o=a;if(r(a)){delete s[i];t.setItem("Backendless",e.serialize(s));o=undefined}if(o&&o["cachePolicy"]){delete o["cachePolicy"]}return o};e.remove=function(r){var i;n();r=r.replace(/([^A-Za-z0-9-])/g,"");var s=e.deserialize(t.getItem("Backendless"));if(s.hasOwnProperty(r)){i=delete s[r]}t.setItem("Backendless",e.serialize(s));return i};e.clear=function(){t.setItem("Backendless",e.serialize({}))};e.getAll=function(){n();var r=e.deserialize(t.getItem("Backendless"));var i={};for(var s in r){if(r.hasOwnProperty(s)){i[s]=r[s];if(i[s]!==null&&i[s].hasOwnProperty("cachePolicy")){delete i[s]["cachePolicy"]}}}return i};e.flushExpired=function(){n();var i=e.deserialize(t.getItem("Backendless")),s;for(var a in i){if(i.hasOwnProperty(a)){s=i[a];if(r(s)){delete i[a];t.setItem("Backendless",e.serialize(i))}}}};e.getCachePolicy=function(r){n();var i=e.deserialize(t.getItem("Backendless"));var s=i[r];return s?s["cachePolicy"]:undefined};return e}Backendless.LocalCache=setCache();if(Backendless.LocalCache.enabled){Backendless.LocalCache.flushExpired()}function DataStore(e){this.model=Utils.isString(e)?function(){}:e;this.className=Utils.getClassName(e);if((typeof e).toLowerCase()==="string"){this.className=e}if(!this.className){throw new Error("Class name should be specified")}this.restUrl=Backendless.appPath+"/data/"+this.className;this.bulkRestUrl=Backendless.appPath+"/data/bulk/"+this.className}DataStore.prototype={_extractQueryOptions:function(e){var t=[];if(typeof e.pageSize!=="undefined"){if(e.pageSize<1||e.pageSize>100){throw new Error("PageSize can not be less then 1 or greater than 100")}t.push("pageSize="+encodeURIComponent(e.pageSize))}if(typeof e.offset!=="undefined"){if(e.offset<0){throw new Error("Offset can not be less then 0")}t.push("offset="+encodeURIComponent(e.offset))}if(e.sortBy){if(Utils.isString(e.sortBy)){t.push("sortBy="+encodeURIComponent(e.sortBy))}else if(Utils.isArray(e.sortBy)){t.push("sortBy="+Utils.encodeArrayToUriComponent(e.sortBy))}}if(e.relationsDepth){if(Utils.isNumber(e.relationsDepth)){t.push("relationsDepth="+Math.floor(e.relationsDepth))}}if(e.relations){if(Utils.isArray(e.relations)){t.push("loadRelations="+(e.relations.length?Utils.encodeArrayToUriComponent(e.relations):"*"))}}return t.join("&")},_parseResponse:function(e){var t=this.model,n;e=e.fields||e;n=new t;Utils.deepExtend(n,e);return this._formCircDeps(n)},_parseFindResponse:function(e,t){var n=t===undefined?this.model:t;var r;var i=function(e){var t=Utils.isFunction(n)?new n:{};e=e.fields||e;return Utils.deepExtend(t,e)};if(Utils.isArray(e)){r=e.map(i)}else{r=i(e)}return this._formCircDeps(r)},_load:function(e,t){if(e){var n=Utils.extractResponder(arguments),r=false;if(n!=null){r=true;n=Utils.wrapAsync(n,this._parseResponse,this)}var i=Backendless._ajax({method:"GET",url:e,isAsync:r,asyncHandler:n});return r?i:this._parseResponse(i)}},_replCircDeps:function(e){var t=[e];var n;var r=function(){for(var e="",t=e;t++<36;e+=t*51&&52?(t^15?8^Math.random()*(t^20?16:4):4).toString(16):"-"){}return e};var i=function(e){for(var s in e){if(e.hasOwnProperty(s)&&typeof e[s]==="object"&&e[s]!=null){if((n=t.indexOf(e[s]))!==-1){t[n]["__subID"]=t[n]["__subID"]||r();e[s]={__originSubID:t[n]["__subID"]}}else if(Utils.isDate(e[s])){e[s]=e[s].getTime()}else{t.push(e[s]);i(e[s])}}}};i(e)},_formCircDeps:function(e){var t=new e.constructor;var n={};var r=[];var i=function(e,t){if(r.indexOf(e)===-1){r.push(e);if(e.hasOwnProperty("__subID")){n[e["__subID"]]=t;delete e["__subID"]}for(var s in e){if(e.hasOwnProperty(s)){if(typeof e[s]==="object"&&e[s]!=null){if(e[s].hasOwnProperty("__originSubID")){t[s]=n[e[s]["__originSubID"]]}else{t[s]=new e[s].constructor;i(e[s],t[s])}}else{t[s]=e[s]}}}}};i(e,t);return t},save:promisified("_save"),saveSync:synchronized("_save"),_save:function(e,t){this._replCircDeps(e);var n=Utils.extractResponder(arguments),r=false,i="PUT",s=this.restUrl,a=e;if(n!=null){r=true;n=Utils.wrapAsync(n,this._parseResponse,this)}var o=Backendless._ajax({method:i,url:s,data:JSON.stringify(e),isAsync:r,asyncHandler:n});if(!r){Utils.deepExtend(a,this._parseResponse(o))}return r?o:a},remove:promisified("_remove"),removeSync:synchronized("_remove"),_remove:function(e,t){if(!Utils.isObject(e)&&!Utils.isString(e)){throw new Error('Invalid value for the "value" argument. The argument must contain only string or object values')}var n=Utils.extractResponder(arguments),r=false;if(n!=null){r=true;n=Utils.wrapAsync(n,this._parseResponse,this)}var i;if(Utils.isString(e)||e.objectId){e=e.objectId||e;i=Backendless._ajax({method:"DELETE",url:this.restUrl+"/"+e,isAsync:r,asyncHandler:n})}else{i=Backendless._ajax({method:"DELETE",url:this.restUrl,data:JSON.stringify(e),isAsync:r,asyncHandler:n})}return r?i:this._parseResponse(i)},find:promisified("_find"),findSync:synchronized("_find"),_find:function(e){var t=this._parseFindArguments(arguments);var n=t.queryBuilder?t.queryBuilder.build():{};return this._findUtil(n,t.async)},_validateFindArguments:function(e){if(e.length===0){return}if(!(e[0]instanceof Backendless.DataQueryBuilder)&&!(e[0]instanceof Async)){throw new Error("Invalid find method argument. "+"The argument should be instance of Backendless.DataQueryBuilder or Async")}},_parseFindArguments:function(e){this._validateFindArguments(e);var t={queryBuilder:e[0]instanceof Backendless.DataQueryBuilder?e[0]:null,async:e[0]instanceof Async?e[0]:null};if(e.length>1){t.async=e[1]}return t},_findUtil:function(e){e=e||{};var t,n,r,i=[],s=this.restUrl,a=Utils.extractResponder(arguments),o=a!=null,c;if(e.properties&&e.properties.length){t="props="+Utils.encodeArrayToUriComponent(e.properties)}if(e.condition){n="where="+encodeURIComponent(e.condition)}if(e.options){r=this._extractQueryOptions(e.options)}a!=null&&(a=Utils.wrapAsync(a,this._parseFindResponse,this));r&&i.push(r);n&&i.push(n);t&&i.push(t);i=i.join("&");if(e.url){s+="/"+e.url}if(i){s+="?"+i}c=Backendless._ajax({method:"GET",url:s,isAsync:o,asyncHandler:a,cachePolicy:e.cachePolicy});return o?c:this._parseFindResponse(c)},findById:promisified("_findById"),findByIdSync:synchronized("_findById"),_findById:function(){var e;var t=Utils.extractResponder(arguments);if(Utils.isString(arguments[0])){e=!(arguments[1]instanceof Async)?arguments[1]||{}:{};e.url=arguments[0];if(!e.url){throw new Error('missing argument "object ID" for method findById()')}return this._findUtil(e,t)}else if(Utils.isObject(arguments[0])){e=arguments[0];var n=this.restUrl,r=t!=null,i="/pk?";for(var s in e){i+=s+"="+e[s]+"&"}t!=null&&(t=Utils.wrapAsync(t,this._parseResponse,this));var a;if(Utils.getClassName(arguments[0])==="Object"){a=Backendless._ajax({method:"GET",url:n+i.replace(/&$/,""),isAsync:r,asyncHandler:t})}else{a=Backendless._ajax({method:"PUT",url:n,data:JSON.stringify(e),isAsync:r,asyncHandler:t})}return r?a:this._parseResponse(a)}else{throw new Error('Invalid value for the "value" argument. The argument must contain only string or object values')}},loadRelations:promisified("_loadRelations"),loadRelationsSync:synchronized("_loadRelations"),_loadRelations:function(e,t,n){this._validateLoadRelationsArguments(e,t);var r,i,s=[];var a=t.build();if(a.condition){r="where="+encodeURIComponent(a.condition)}if(a.options){i=this._extractQueryOptions(a.options)}i&&s.push(i);r&&s.push(r);s=s.join("&");var o=a.relationModel||null;var c=Utils.extractResponder(arguments);var l=a.options.relationName;var u=this.restUrl+Utils.toUri(e,l);c=c&&Utils.wrapAsync(c,function(e){return this._parseFindResponse(e,o)},this);if(s){u+="?"+s}var d=Backendless._ajax({method:"GET",url:u,isAsync:!!c,asyncHandler:c});return!!c?d:this._parseFindResponse(d,o)},_validateLoadRelationsArguments:function(e,t){if(!e||!Utils.isString(e)){throw new Error("The parentObjectId is required argument and must be a nonempty string")}if(!t||!(t instanceof Backendless.LoadRelationsQueryBuilder)){throw new Error("Invalid queryBuilder object."+"The queryBuilder is required and must be instance of the Backendless.LoadRelationsQueryBuilder")}var n=t.build();var r=n.options&&n.options.relationName;if(!r||!Utils.isString(r)){throw new Error("The options relationName is required and must contain string value")}},findFirst:promisified("_findFirst"),findFirstSync:synchronized("_findFirst"),_findFirst:function(){var e=!(arguments[0]instanceof Async)?arguments[0]||{}:{};e.url="first";return this._findUtil.apply(this,[e].concat(Array.prototype.slice.call(arguments)))},findLast:promisified("_findLast"),findLastSync:synchronized("_findLast"),_findLast:function(){var e=!(arguments[0]instanceof Async)?arguments[0]||{}:{};e.url="last";return this._findUtil.apply(this,[e].concat(Array.prototype.slice.call(arguments)))},getObjectCount:promisified("_getObjectCount"),getObjectCountSync:synchronized("_getObjectCount"),_getObjectCount:function(e,t){var n=this._parseFindArguments(arguments);var r=n.queryBuilder?n.queryBuilder.build():{};var i=this.restUrl+"/count";var s=!!n.async;if(r.condition){i+="?where="+encodeURIComponent(r.condition)}return Backendless._ajax({method:"GET",url:i,isAsync:s,asyncHandler:n.async})},setRelation:promisified("_setRelation"),setRelationSync:synchronized("_setRelation"),_setRelation:function(){return this._manageRelation("POST",arguments)},addRelation:promisified("_addRelation"),addRelationSync:synchronized("_addRelation"),_addRelation:function(){return this._manageRelation("PUT",arguments)},deleteRelation:promisified("_deleteRelation"),deleteRelationSync:synchronized("_deleteRelation"),_deleteRelation:function(){return this._manageRelation("DELETE",arguments)},_collectRelationObject:function(e){var t={columnName:e[1]};var n=e[0];if(Utils.isString(n)){t.parentId=n}else if(Utils.isObject(n)){t.parentId=n.objectId}var r=e[2];if(Utils.isString(r)){t.whereClause=r}else if(Utils.isArray(r)){t.childrenIds=r.map(function(e){return Utils.isObject(e)?e.objectId:e})}return t},_validateRelationObject:function(e){if(!e.parentId){throw new Error('Invalid value for the "parent" argument. '+"The argument is required and must contain only string or object values.")}if(!e.columnName){throw new Error('Invalid value for the "columnName" argument. '+"The argument is required and must contain only string values.")}if(!e.whereClause&&!e.childrenIds){throw new Error("Invalid value for the third argument. "+"The argument is required and must contain string values if it sets whereClause "+"or array if it sets childObjects.")}},_manageRelation:function(e,t){var n=this._collectRelationObject(t);var r=Utils.extractResponder(t);this._validateRelationObject(n);return Backendless._ajax({method:e,url:this._buildRelationUrl(n),isAsync:!!r,asyncHandler:r,data:n.childrenIds&&JSON.stringify(n.childrenIds)})},_buildRelationUrl:function(e){var t=this.restUrl+Utils.toUri(e.parentId,e.columnName);if(e.whereClause){t+="?"+Utils.toQueryParams({where:e.whereClause})}return t},bulkUpdate:promisified("_bulkUpdate"),bulkUpdateSync:synchronized("_bulkUpdate"),_bulkUpdate:function(e,t,n){this._validateBulkUpdateArgs(e,t);return Backendless._ajax({method:"PUT",url:this.bulkRestUrl+"?"+Utils.toQueryParams({where:t}),data:JSON.stringify(e),isAsync:!!n,asyncHandler:n})},bulkDelete:promisified("_bulkDelete"),bulkDeleteSync:synchronized("_bulkDelete"),_bulkDelete:function(e,t){this._validateBulkDeleteArg(e);var n;var r;if(Utils.isString(e)){n=e}else if(Utils.isArray(e)){r=e.map(function(e){return Utils.isString(e)?e:e.objectId});n="objectId in ('"+r.join("', '")+"')"}return Backendless._ajax({method:"DELETE",url:this.bulkRestUrl+"?"+Utils.toQueryParams({where:n}),isAsync:!!t,asyncHandler:t})},_validateBulkUpdateArgs:function(e,t){if(!e||!Utils.isObject(e)){throw new Error("Invalid templateObject argument. The first argument must contain object")}if(!t||!Utils.isString(t)){throw new Error('Invalid whereClause argument. The first argument must contain "whereClause" string.')}},_validateBulkDeleteArg:function(e){var t="Invalid bulkDelete argument. "+'The first argument must contain array of objects or array of id or "whereClause" string';if(!e||!Utils.isArray(e)&&!Utils.isString(e)){throw new Error(t)}for(var n=0;n<e.length;n++){if(!Utils.isObject(e[n])&&!Utils.isString(e[n])){throw new Error(t)}}}};var dataStoreCache={};var persistence={save:promisified("_save"),saveSync:synchronized("_save"),_save:function(e,t,n){var r=Utils.extractResponder(arguments);var i=!!r;if(Utils.isString(e)){var s=Backendless.appPath+"/data/"+e;return Backendless._ajax({method:"POST",url:s,data:JSON.stringify(t),isAsync:i,asyncHandler:r})}if(Utils.isObject(e)){return new DataStore(e)._save(e,t,n)}},getView:promisified("_getView"),getViewSync:synchronized("_getView"),_getView:function(e,t,n,r,i){var s=Utils.extractResponder(arguments),a=s!=null;if(Utils.isString(e)){var o=Backendless.appPath+"/data/"+e;if(arguments.length>1&&!(arguments[1]instanceof Async)){o+="?"}if(Utils.isString(t)){o+="where="+t}else{n=t;r=n}if(Utils.isNumber(n)){o+="&"+(new DataStore)._extractQueryOptions({pageSize:n})}if(Utils.isNumber(r)){o+="&"+(new DataStore)._extractQueryOptions({offset:r})}return Backendless._ajax({method:"GET",url:o,isAsync:a,asyncHandler:s})}else{throw new Error("View name is required string parameter")}},callStoredProcedure:promisified("_callStoredProcedure"),callStoredProcedureSync:synchronized("_callStoredProcedure"),_callStoredProcedure:function(e,t,n){var r=Utils.extractResponder(arguments),i=r!=null;if(Utils.isString(e)){var s=Backendless.appPath+"/data/"+e,a={};if(Utils.isObject(t)){a=JSON.stringify(t)}return Backendless._ajax({method:"POST",url:s,data:a,isAsync:i,asyncHandler:r})}else{throw new Error("Stored Procedure name is required string parameter")}},of:function(e){var t;if(Utils.isString(e)){t=e}else{t=Utils.getClassName(e)}var n=dataStoreCache[t];if(!n){n=new DataStore(e);dataStoreCache[t]=n}return n},describe:promisified("_describe"),describeSync:synchronized("_describe"),_describe:function(e,t){e=Utils.isString(e)?e:Utils.getClassName(e);var n=Utils.extractResponder(arguments),r=n!=null;return Backendless._ajax({method:"GET",url:Backendless.appPath+"/data/"+e+"/properties",isAsync:r,asyncHandler:n})}};function DataPermissions(){this.FIND=new DataPermission("FIND");this.REMOVE=new DataPermission("REMOVE");this.UPDATE=new DataPermission("UPDATE")}function DataPermission(e){this.permission=e;this.restUrl=Backendless.appPath+"/data"}DataPermission.prototype={grantUser:promisified("_grantUser"),grantUserSync:synchronized("_grantUser"),_grantUser:function(e,t,n){return this._sendRequest({userId:e,dataObject:t,responder:n,permissionType:"GRANT"})},grantRole:promisified("_grantRole"),grantRoleSync:synchronized("_grantRole"),_grantRole:function(e,t,n){return this._sendRequest({roleName:e,dataObject:t,responder:n,permissionType:"GRANT"})},grant:promisified("_grant"),grantSync:synchronized("_grant"),_grant:function(e,t){return this._sendRequest({userId:"*",dataObject:e,responder:t,permissionType:"GRANT"})},denyUser:promisified("_denyUser"),denyUserSync:synchronized("_denyUser"),_denyUser:function(e,t,n){return this._sendRequest({userId:e,dataObject:t,responder:n,permissionType:"DENY"})},denyRole:promisified("_denyRole"),denyRoleSync:synchronized("_denyRole"),_denyRole:function(e,t,n){return this._sendRequest({roleName:e,dataObject:t,responder:n,permissionType:"DENY"})},deny:promisified("_deny"),denySync:synchronized("_deny"),_deny:function(e,t){return this._sendRequest({userId:"*",dataObject:e,responder:t,permissionType:"DENY"})},_getRestUrl:function(e,t){return this.restUrl+"/"+encodeURIComponent(e.___class)+"/permissions/"+t+"/"+encodeURIComponent(e.objectId)},_sendRequest:function(e){var t=e.dataObject;var n=e.userId;var r=e.roleName;var i=e.responder;var s=!!i;var a={permission:this.permission};if(!t.___class||!t.objectId){throw new Error('"dataObject.___class" and "dataObject.objectId" need to be specified')}if(n){a.user=n}else if(r){a.role=r}return Backendless._ajax({method:"PUT",url:this._getRestUrl(t,e.permissionType),data:JSON.stringify(a),isAsync:s,asyncHandler:i})}};function User(e){e=e||{};for(var t in e){this[t]=e[t]}}User.prototype.___class="Users";Backendless.User=User;var currentUser=null;var UserService=function(){this.restUrl=Backendless.appPath+"/users"};UserService.prototype={_wrapAsync:function(e,t){var n=this,r=function(r){currentUser=n._parseResponse(Utils.tryParseJSON(r),t);e.success(n._getUserFromResponse(currentUser))},i=function(t){e.fault(t)};return new Async(r,i)},_parseResponse:function(e,t){var n=new Backendless.User;Utils.deepExtend(n,e);if(t){Backendless.LocalCache.set("stayLoggedIn",t)}return n},register:promisified("_register"),registerSync:synchronized("_register"),_register:function(e,t){if(!(e instanceof Backendless.User)){throw new Error("Only Backendless.User accepted")}var n=Utils.extractResponder(arguments);var r=n!=null;if(n){n=this._wrapAsync(n)}var i=Backendless._ajax({method:"POST",url:this.restUrl+"/register",isAsync:r,asyncHandler:n,data:JSON.stringify(e)});return r?i:this._parseResponse(i)},getUserRoles:promisified("_getUserRoles"),getUserRolesSync:synchronized("_getUserRoles"),_getUserRoles:function(e){var t=Utils.extractResponder(arguments);var n=t!=null;var r=Backendless._ajax({method:"GET",url:this.restUrl+"/userroles",isAsync:n,asyncHandler:t});return n?r:this._parseResponse(r)},_roleHelper:function(e,t,n,r){if(!e){throw new Error("User identity can not be empty")}if(!t){throw new Error("Rolename can not be empty")}var i=Utils.extractResponder(arguments);return Backendless._ajax({method:"POST",url:this.restUrl+"/"+r,isAsync:!!i,asyncHandler:i,data:JSON.stringify({user:e,roleName:t})})},assignRole:promisified("_assignRole"),assignRoleSync:synchronized("_assignRole"),_assignRole:function(e,t,n){return this._roleHelper(e,t,n,"assignRole")},unassignRole:promisified("_unassignRole"),unassignRoleSync:synchronized("_unassignRole"),_unassignRole:function(e,t,n){return this._roleHelper(e,t,n,"unassignRole")},login:promisified("_login"),loginSync:synchronized("_login"),_login:function(e,t,n,r){if(!e){throw new Error("Login can not be empty")}if(!t){throw new Error("Password can not be empty")}n=n===true;Backendless.LocalCache.remove("user-token");Backendless.LocalCache.remove("current-user-id");Backendless.LocalCache.set("stayLoggedIn",false);var i=Utils.extractResponder(arguments);var s=i!=null;if(i){i=this._wrapAsync(i,n)}var a={login:e,password:t};var o=Backendless._ajax({method:"POST",url:this.restUrl+"/login",isAsync:s,asyncHandler:i,data:JSON.stringify(a)});if(!s&&o){currentUser=this._parseResponse(o,n);o=this._getUserFromResponse(currentUser)}return o},_getUserFromResponse:function(e){Backendless.LocalCache.set("current-user-id",e.objectId);var t=e["user-token"];if(t&&Backendless.LocalCache.get("stayLoggedIn")){Backendless.LocalCache.set("user-token",t)}return new Backendless.User(e)},loggedInUser:function(){return Backendless.LocalCache.get("current-user-id")},describeUserClass:promisified("_describeUserClass"),describeUserClassSync:synchronized("_describeUserClass"),_describeUserClass:function(e){var t=Utils.extractResponder(arguments);var n=t!=null;return Backendless._ajax({method:"GET",url:this.restUrl+"/userclassprops",isAsync:n,asyncHandler:t})},restorePassword:promisified("_restorePassword"),restorePasswordSync:synchronized("_restorePassword"),_restorePassword:function(e,t){if(!e){throw new Error("emailAddress can not be empty")}var n=Utils.extractResponder(arguments);var r=n!=null;return Backendless._ajax({method:"GET",url:this.restUrl+"/restorepassword/"+encodeURIComponent(e),isAsync:r,asyncHandler:n})},logout:promisified("_logout"),logoutSync:synchronized("_logout"),_logout:function(e){var t=Utils.extractResponder(arguments),n=t!=null,r=n?t.fault:null,i=n?t.success:null,s={},a=function(){Backendless.LocalCache.remove("user-token");Backendless.LocalCache.remove("current-user-id");Backendless.LocalCache.remove("stayLoggedIn");currentUser=null},o=function(){a();if(Utils.isFunction(i)){i()}},c=function(e){if(Utils.isObject(e)&&[3064,3091,3090,3023].indexOf(e.code)!==-1){a()}if(Utils.isFunction(r)){r(e)}};if(t){t.fault=c;t.success=o}try{s=Backendless._ajax({method:"GET",url:this.restUrl+"/logout",isAsync:n,asyncHandler:t})}catch(e){c(e)}if(n){return s}else{a()}},getCurrentUser:promisified("_getCurrentUser"),getCurrentUserSync:synchronized("_getCurrentUser"),_getCurrentUser:function(e){if(currentUser){var t=this._getUserFromResponse(currentUser);return e?e.success(t):t}var n=Backendless.LocalCache.get("stayLoggedIn");var r=n&&Backendless.LocalCache.get("current-user-id");if(r){return persistence.of(User).findById(r,e)}return e?e.success(null):null},update:promisified("_update"),updateSync:synchronized("_update"),_update:function(e,t){var n=Utils.extractResponder(arguments);var r=n!=null;if(n){n=this._wrapAsync(n)}var i=Backendless._ajax({method:"PUT",url:this.restUrl+"/"+e.objectId,isAsync:r,asyncHandler:n,data:JSON.stringify(e)});return r?i:this._parseResponse(i)},loginWithFacebook:promisified("_loginWithFacebook"),loginWithFacebookSync:synchronized("_loginWithFacebook"),_loginWithFacebook:function(e,t,n,r){return this._loginSocial("Facebook",e,t,null,n,r)},loginWithGooglePlus:promisified("_loginWithGooglePlus"),loginWithGooglePlusSync:synchronized("_loginWithGooglePlus"),_loginWithGooglePlus:function(e,t,n,r,i){return this._loginSocial("GooglePlus",e,t,n,r,i)},loginWithTwitter:promisified("_loginWithTwitter"),loginWithTwitterSync:synchronized("_loginWithTwitter"),_loginWithTwitter:function(e,t,n){return this._loginSocial("Twitter",e,null,null,t,n)},_socialContainer:function(e,t){var n;if(t){var r;t=t[0];n=document.createElement("div");n.innerHTML="Loading...";t.appendChild(n);t.style.cursor="wait";this.closeContainer=function(){t.style.cursor="default";t.removeChild(r)};this.removeLoading=function(){t.removeChild(n)};this.doAuthorizationActivity=function(e){this.removeLoading();r=document.createElement("iframe");r.frameBorder=0;r.width=t.style.width;r.height=t.style.height;r.id="SocialAuthFrame";r.setAttribute("src",e+"&amp;output=embed");t.appendChild(r);r.onload=function(){t.style.cursor="default"}}}else{t=window.open("",e+" authorization","resizable=yes, scrollbars=yes, titlebar=yes, top=10, left=10");n=t.document.getElementsByTagName("body")[0].innerHTML;n="Loading...";t.document.getElementsByTagName("html")[0].style.cursor="wait";this.closeContainer=function(){t.close()};this.removeLoading=function(){n=null};this.doAuthorizationActivity=function(e){t.location.href=e;t.onload=function(){t.document.getElementsByTagName("html")[0].style.cursor="default"}}}},_loginSocial:function(e,t,n,r,i,s){var a=new this._socialContainer(e,r);s=Utils.extractResponder(arguments);s=this._wrapAsync(s,i);Utils.addEvent("message",window,function(e){if(e.origin==Backendless.serverURL){var t=JSON.parse(e.data);if(t.fault){s.fault(t.fault)}else{s.success(t)}Utils.removeEvent("message",window);a.closeContainer()}});var o=new Async(function(e){a.doAuthorizationActivity(e)},function(e){a.closeContainer();s.fault(e)});var c={};c.fieldsMapping=t||{};c.permissions=n||[];Backendless._ajax({method:"POST",url:this.restUrl+"/social/oauth/"+e.toLowerCase()+"/request_url",isAsync:true,asyncHandler:o,data:JSON.stringify(c)})},loginWithFacebookSdk:function(e,t,n){var r=this;return new Promise(function(i,s){if(!FB){return s(new Error("Facebook SDK not found"))}var a=new Async(i,s,r);FB.getLoginStatus(function(i){if(i.status==="connected"){r._sendSocialLoginRequest(i,"facebook",e,t,a)}else{FB.login(function(n){r._sendSocialLoginRequest(n,"facebook",e,t,a)},n)}})})},loginWithGooglePlusSdk:function(e,t,n){var r=this;return new Promise(function(n,i){if(!gapi){return i(new Error("Google Plus SDK not found"))}var s=new Async(n,i,r);gapi.auth.authorize({client_id:e.client_id,scope:"https://www.googleapis.com/auth/plus.login"},function(n){delete n["g-oauth-window"];r._sendSocialLoginRequest(n,"googleplus",e,t,s)})})},_sendSocialLoginRequest:function(e,t,n,r,i){if(n){e["fieldsMapping"]=n}var s=new Async(function(e){currentUser=context._parseResponse(e);Backendless.LocalCache.set("stayLoggedIn",!!r);i.success(context._getUserFromResponse(currentUser))},function(e){i.fault(e)});Backendless._ajax({method:"POST",url:this.restUrl+"/social/"+t+"/login/"+Backendless.applicationId,isAsync:true,asyncHandler:s,data:JSON.stringify(e)})},isValidLogin:promisified("_isValidLogin"),isValidLoginSync:synchronized("_isValidLogin"),_isValidLogin:function(e){var t=Backendless.LocalCache.get("user-token");var n=Utils.extractResponder(arguments);var r=!!n;if(t){if(!r){try{var i=Backendless._ajax({method:"GET",url:this.restUrl+"/isvalidusertoken/"+t});return!!i}catch(e){return false}}return Backendless._ajax({method:"GET",url:this.restUrl+"/isvalidusertoken/"+t,isAsync:r,asyncHandler:n})}if(!r){return!!this.getCurrentUserSync()}this.getCurrentUser().then(function(e){n.success(!!e)},function(){n.success(false)})},resendEmailConfirmation:promisified("_resendEmailConfirmation"),resendEmailConfirmationSync:synchronized("_resendEmailConfirmation"),_resendEmailConfirmation:function(e,t){if(!e||e instanceof Async){throw new Error("Email cannot be empty")}var n=Utils.extractResponder(arguments);var r=!!n;return Backendless._ajax({method:"POST",url:this.restUrl+"/resendconfirmation/"+e,isAsync:r,asyncHandler:n})}};function Geo(){this.restUrl=Backendless.appPath+"/geo";this.monitoringId=null}Geo.prototype={UNITS:{METERS:"METERS",KILOMETERS:"KILOMETERS",MILES:"MILES",YARDS:"YARDS",FEET:"FEET"},_load:function(e,t){var n=Utils.extractResponder(arguments),r=n!=null;return Backendless._ajax({method:"GET",url:e,isAsync:r,asyncHandler:n})},_findHelpers:{searchRectangle:function(e){var t=["nwlat="+e[0],"nwlon="+e[1],"selat="+e[2],"selon="+e[3]];return t.join("&")},latitude:function(e){return"lat="+e},longitude:function(e){return"lon="+e},metadata:function(e){return"metadata="+JSON.stringify(e)},units:function(e){return"units="+e},radius:function(e){return"r="+e},categories:function(e){e=Utils.isString(e)?[e]:e;return"categories="+Utils.encodeArrayToUriComponent(e)},includeMetadata:function(e){return"includemetadata="+e},pageSize:function(e){if(e<1||e>100){throw new Error("PageSize can not be less then 1 or greater than 100")}else{return"pagesize="+e}},offset:function(e){if(e<0){throw new Error("Offset can not be less then 0")}else{return"offset="+e}},relativeFindPercentThreshold:function(e){if(e<=0){throw new Error("Threshold can not be less then or equal 0")}else{return"relativeFindPercentThreshold="+e}},relativeFindMetadata:function(e){return"relativeFindMetadata="+encodeURIComponent(JSON.stringify(e))},condition:function(e){return"whereClause="+encodeURIComponent(e)},degreePerPixel:function(e){return"dpp="+e},clusterGridSize:function(e){return"clustergridsize="+e},geoFence:function(e){return"geoFence="+e}},_validateQueryObject:function(e){if(e.geoFence!==undefined&&!Utils.isString(e.geoFence)){throw new Error('Invalid value for argument "geoFenceName". Geo Fence Name must be a String')}if(e.searchRectangle&&e.radius){throw new Error("Inconsistent geo query. Query should not contain both rectangle and radius search parameters.")}if(e.radius&&(e.latitude===undefined||e.longitude===undefined)){throw new Error("Latitude and longitude should be provided to search in radius")}if((e.relativeFindMetadata||e.relativeFindPercentThreshold)&&!(e.relativeFindMetadata&&e.relativeFindPercentThreshold)){throw new Error("Inconsistent geo query. Query should contain both relativeFindPercentThreshold and relativeFindMetadata or none of them")}},_toQueryParams:function(e){var t=[];if(e.units){t.push("units="+e.units)}for(var n in e){if(e.hasOwnProperty(n)&&this._findHelpers.hasOwnProperty(n)&&e[n]!=null){t.push(this._findHelpers[n](e[n]))}}return t.join("&")},savePoint:promisified("_savePoint"),savePointSync:synchronized("_savePoint"),_savePoint:function(e,t){if(null==e.latitude||null==e.longitude){throw new Error("Latitude or longitude not a number")}e.categories=e.categories||["Default"];e.categories=Utils.isArray(e.categories)?e.categories:[e.categories];var n=e.objectId;var r=n?"PATCH":"POST",i=this.restUrl+"/points";if(n){i+="/"+n}var s=Utils.extractResponder(arguments);var a=s!=null;var o=function(e){var t=function(t){var n=new GeoPoint;n.categories=t.geopoint.categories;n.latitude=t.geopoint.latitude;n.longitude=t.geopoint.longitude;n.metadata=t.geopoint.metadata;n.objectId=t.geopoint.objectId;e.success(n)};var n=function(t){e.fault(t)};return new Async(t,n)};s=o(s);return Backendless._ajax({method:r,url:i,data:JSON.stringify(e),isAsync:a,asyncHandler:s})},addPoint:function(e,t){return this.savePoint.apply(this,arguments)},_findUtil:function(e,t){var n=Utils.extractResponder(arguments),r=false;this._validateQueryObject(e);var i=e.url+(e.searchRectangle?"/rect":"/points")+"?"+this._toQueryParams(e);var s=function(t){var n=function(n){var r=[];var i;var s;var a;var o=n.collection||n;for(var c=0;c<o.length;c++){i=o[c];i.geoQuery=e;s=i.hasOwnProperty("totalPoints");a=s?GeoCluster:GeoPoint;r.push(new a(i))}t.success(r)};var r=function(e){t.fault(e)};return new Async(n,r)};if(n!=null){r=true}n=s(n);return Backendless._ajax({method:"GET",url:i,isAsync:r,asyncHandler:n})},find:promisified("_find"),findSync:synchronized("_find"),_find:function(e,t){e["url"]=this.restUrl;return this._findUtil(e,t)},loadMetadata:promisified("_loadMetadata"),loadMetadataSync:synchronized("_loadMetadata"),_loadMetadata:function(e,t){var n=this.restUrl+"/points/",r=Utils.extractResponder(arguments),i=false;if(e.objectId){if(e instanceof GeoCluster){if(e.geoQuery instanceof GeoQuery){n+=e.objectId+"/metadata?";for(var s in e.geoQuery){if(e.geoQuery.hasOwnProperty(s)&&this._findHelpers.hasOwnProperty(s)&&e.geoQuery[s]!=null){n+="&"+this._findHelpers[s](e.geoQuery[s])}}}else{throw new Error("Invalid GeoCluster object. Make sure to obtain an instance of GeoCluster using the Backendless.Geo.find API")}}else if(e instanceof GeoPoint){n+=e.objectId+"/metadata"}else{throw new Error("Method argument must be a valid instance of GeoPoint or GeoCluster persisted on the server")}}else{throw new Error("Method argument must be a valid instance of GeoPoint or GeoCluster persisted on the server")}if(r!=null){i=true}return Backendless._ajax({method:"GET",url:n,isAsync:i,asyncHandler:r})},getClusterPoints:promisified("_getClusterPoints"),getClusterPointsSync:synchronized("_getClusterPoints"),_getClusterPoints:function(e,t){var n=this.restUrl+"/clusters/",r=Utils.extractResponder(arguments),i=false;if(e.objectId){if(e instanceof GeoCluster){if(e.geoQuery instanceof GeoQuery){n+=e.objectId+"/points?";for(var s in e.geoQuery){if(e.geoQuery.hasOwnProperty(s)&&this._findHelpers.hasOwnProperty(s)&&e.geoQuery[s]!=null){n+="&"+this._findHelpers[s](e.geoQuery[s])}}}else{throw new Error("Invalid GeoCluster object. Make sure to obtain an instance of GeoCluster using the Backendless.Geo.find API")}}else{throw new Error("Method argument must be a valid instance of GeoCluster persisted on the server")}}else{throw new Error("Method argument must be a valid instance of GeoCluster persisted on the server")}var a=function(e){var t=function(t){for(var n=0;n<t.length;n++){t[n]=new GeoPoint(t[n])}e.success(t)};var n=function(t){e.fault(t)};return new Async(t,n)};if(r!=null){i=true}r=a(r);return Backendless._ajax({method:"GET",url:n,isAsync:i,asyncHandler:r})},relativeFind:promisified("_relativeFind"),relativeFindSync:synchronized("_relativeFind"),_relativeFind:function(e,t){if(!(e.relativeFindMetadata&&e.relativeFindPercentThreshold)){throw new Error("Inconsistent geo query. Query should contain both relativeFindPercentThreshold and relativeFindMetadata")}else{e["url"]=this.restUrl+"/relative";return this._findUtil(e,t)}},addCategory:promisified("_addCategory"),addCategorySync:synchronized("_addCategory"),_addCategory:function(e,t){if(!e){throw new Error("Category name is required.")}var n=Utils.extractResponder(arguments);var r=n!=null;var i=Backendless._ajax({method:"PUT",url:this.restUrl+"/categories/"+e,isAsync:r,asyncHandler:n});return typeof i.result==="undefined"?i:i.result},getCategories:promisified("_getCategories"),getCategoriesSync:synchronized("_getCategories"),_getCategories:function(e){var t=Utils.extractResponder(arguments);var n=t!=null;return Backendless._ajax({method:"GET",url:this.restUrl+"/categories",isAsync:n,asyncHandler:t})},deleteCategory:promisified("_deleteCategory"),deleteCategorySync:synchronized("_deleteCategory"),_deleteCategory:function(e,t){if(!e){throw new Error("Category name is required.")}var n=Utils.extractResponder(arguments);var r=n!=null;var i={};try{i=Backendless._ajax({method:"DELETE",url:this.restUrl+"/categories/"+e,isAsync:r,asyncHandler:n})}catch(e){if(e.statusCode==404){i=false}else{throw e}}return typeof i.result==="undefined"?i:i.result},deletePoint:promisified("_deletePoint"),deletePointSync:synchronized("_deletePoint"),_deletePoint:function(e,t){if(!e||Utils.isFunction(e)){throw new Error("Point argument name is required, must be string (object Id), or point object")}var n=Utils.isString(e)?e:e.objectId,r=Utils.extractResponder(arguments),i=r!=null,s={};try{s=Backendless._ajax({method:"DELETE",url:this.restUrl+"/points/"+n,isAsync:i,asyncHandler:r})}catch(e){if(e.statusCode==404){s=false}else{throw e}}return typeof s.result==="undefined"?s:s.result},getFencePoints:promisified("_getFencePoints"),getFencePointsSync:synchronized("_getFencePoints"),_getFencePoints:function(e,t,n){t=t||new GeoQuery;t.geoFence=e;t.url=this.restUrl;return this._findUtil(t,n)},getGeopointCount:promisified("_getGeopointCount"),getGeopointCountSync:synchronized("_getGeopointCount"),_getGeopointCount:function(e,t,n){var r=Utils.extractResponder(arguments);var i=!!r;t=this._buildCountQueryObject(arguments,i);this._validateQueryObject(t);var s=this.restUrl+"/count?"+this._toQueryParams(t);return Backendless._ajax({method:"GET",url:s,isAsync:i,asyncHandler:r})},_buildCountQueryObject:function(e,t){e=t?Array.prototype.slice.call(e,0,-1):e;var n;var r;if(e.length===1){n=e[0]}if(e.length===2){r=e[0];n=e[1];n["geoFence"]=r}return n},_runFenceAction:function(e,t,n,r){if(!Utils.isString(t)){throw new Error("Invalid value for parameter 'geoFenceName'. Geo Fence Name must be a String")}if(n&&!(n instanceof Async)&&!(n instanceof GeoPoint)&&!n.objectId){throw new Error("Method argument must be a valid instance of GeoPoint persisted on the server")}var i=Utils.extractResponder(arguments),s=i!=null,a={method:"POST",url:this.restUrl+"/fence/"+e+"?geoFence="+t,isAsync:s,asyncHandler:i};if(n){a.data=JSON.stringify(n)}return Backendless._ajax(a)},runOnStayAction:promisified("_runOnStayAction"),runOnStayActionSync:synchronized("_runOnStayAction"),_runOnStayAction:function(e,t,n){return this._runFenceAction("onstay",e,t,n)},runOnExitAction:promisified("_runOnExitAction"),runOnExitActionSync:synchronized("_runOnExitAction"),_runOnExitAction:function(e,t,n){return this._runFenceAction("onexit",e,t,n)},runOnEnterAction:promisified("_runOnEnterAction"),runOnEnterActionSync:synchronized("_runOnEnterAction"),_runOnEnterAction:function(e,t,n){return this._runFenceAction("onenter",e,t,n)},_getFences:function(e){return Backendless._ajax({method:"GET",url:this.restUrl+"/fences"+(e?"?geoFence="+e:"")})},EARTH_RADIUS:6378100,_distance:function(e,t,n,r){var i=t-r;i=i*Math.PI/180;e=e*Math.PI/180;n=n*Math.PI/180;return this.EARTH_RADIUS*Math.acos(Math.sin(e)*Math.sin(n)+Math.cos(e)*Math.cos(n)*Math.cos(i))},_updateDegree:function(e){e+=180;while(e<0){e+=360}return e===0?180:e%360-180},_countLittleRadius:function(e){var t=Math.abs(e)/180*this.EARTH_RADIUS;var n=2*this.EARTH_RADIUS;var r=(Math.pow(n,2)-n*Math.sqrt(Math.pow(n,2)-4*Math.pow(t,2)))/2;return n/2-Math.sqrt(r-Math.pow(t,2))},_isDefiniteRect:function(e,t){return e!=null&&t!=null},_getOutRectangle:function(){return arguments.length===1?this._getOutRectangleNodes(arguments[1]):this._getOutRectangleCircle(arguments[0],arguments[1])},_getOutRectangleCircle:function(e,t){var n=this._distance(e.latitude,e.longitude,t.latitude,t.longitude);var r=e.latitude+180*n/(Math.PI*this.EARTH_RADIUS)*(e.latitude>0?1:-1);var i=this._countLittleRadius(r);var s,a,o,c;if(i>n){s=e.longitude-180*n/i;a=2*e.longitude-s;s=this._updateDegree(s);a=a%360===180?180:this._updateDegree(a)}else{s=-180;a=180}if(e.latitude>0){o=r;c=2*e.latitude-r}else{c=r;o=2*e.latitude-r}return[Math.min(o,90),s,Math.max(c,-90),a]},_getOutRectangleNodes:function(e){var t=e[0].latitude;var n=e[0].longitude;var r=e[0].latitude;var i=e[0].longitude;var s=0,a=0,o=0;for(var c=1;c<e.length;c++){if(e[c].latitude>t){t=e[c].latitude}if(e[c].latitude<r){r=e[c].latitude}var l=e[c].latitude-e[c-1].latitude;if(l<0&&l>-180||l>270){if(l>270){l-=360}o+=l;if(o<s){s=o}}else if(l>0&&l<=180||l<=-270){if(l<=-270){l+=360}o+=l;if(o>a){a=o}}}n+=s;i+=a;if(i-n>=360){i=180;n=-180}else{i=this._updateDegree(i);n=this._updateDegree(n)}return[t,n,r,i]},_getPointPosition:function(e,t,n){var r=n.longitude-t.longitude;if(r<0&&r>-180||r>180){var i=t;t=n;n=i}if(e.latitude<t.latitude===e.latitude<n.latitude){return"NO_INTERSECT"}var s=e.longitude-t.longitude;if(s<0&&s>-180||s>180){s=(s-360)%360}var a=(n.longitude-t.longitude+360)%360;var o=a*(e.latitude-t.latitude)/(n.latitude-t.latitude)-s;if(o>0){return"INTERSECT"}return"NO_INTERSECT"},_isPointInRectangular:function(e,t,n){if(e.latitude>t.latitude||e.latitude<n.latitude){return false}if(t.longitude>n.longitude){return e.longitude>=t.longitude||e.longitude<=n.longitude}else{return e.longitude>=t.longitude&&e.longitude<=n.longitude}},_isPointInCircle:function(e,t,n){return this._distance(e.latitude,e.longitude,t.latitude,t.longitude)<=n},_isPointInShape:function(e,t){var n=0;function r(e,t){return(e+1)%t.length}for(var i=0;i<t.length;i++){var s=this._getPointPosition(e,t[i],t[r(i,t)]);switch(s){case"INTERSECT":{n++;break}case"ON_LINE":case"NO_INTERSECT":default:break}}return n%2===1},_isPointInFence:function(e,t){return this._isPointInRectangular(e,t.nwPoint,t.sePoint)||t.type==="CIRCLE"&&this._isPointInCircle(e,t.nodes[0],this._distance(t.nodes[0].latitude,t.nodes[0].longitude,t.nodes[1].latitude,t.nodes[1].longitude))||t.type==="SHAPE"&&this._isPointInShape(e,t.nodes)},_typesMapper:{RECT:function(e){e.nwPoint=e.nodes[0];e.sePoint=e.nodes[1]},CIRCLE:function(e,t){var n=t._getOutRectangle(e.nodes[0],e.nodes[1]);e.nwPoint={latitude:n[0],longitude:n[1]};e.sePoint={latitude:n[2],longitude:n[3]}},SHAPE:function(e,t){var n=t._getOutRectangle(e.nodes[0],e.nodes[1]);e.nwPoint={latitude:n[0],longitude:n[1]};e.sePoint={latitude:n[2],longitude:n[3]}}},_maxDuration:5e3,_timers:{},_checkPosition:function(e,t,n,r,i,s,a){var o=this;for(var c=0;c<o._trackedFences.length;c++){var l=o._isDefiniteRect(o._trackedFences[c].nwPoint,o._trackedFences[c].sePoint)&&o._isPointInFence(t,o._trackedFences[c]);var u=null;if(l!==s[o._trackedFences[c].geofenceName]){if(s[o._trackedFences[c].geofenceName]){u="onexit"}else{u="onenter"}s[o._trackedFences[c].geofenceName]=l}if(u){var d=o._trackedFences[c].onStayDuration*1e3,f=function(e,t,n){var r=function(){i["onstay"](o._trackedFences[e].geofenceName,o._trackedFences[e].objectId,t.latitude,t.longitude)};o._timers[o._trackedFences[e].geofenceName]=setTimeout(r,n)},h=function(e,t,n,r){var i=function(){o._runFenceAction("onstay",o._trackedFences[e].geofenceName,r,a)};o._timers[o._trackedFences[e].geofenceName]=setTimeout(i,n)};if(i){if(u==="onenter"){i[u](o._trackedFences[c].geofenceName,o._trackedFences[c].objectId,t.latitude,t.longitude);if(d>-1){(function(e,t,n){return f(e,t,n)})(c,t,d)}else{i["onstay"](o._trackedFences[c].geofenceName,o._trackedFences[c].objectId,t.latitude,t.longitude)}}else{clearTimeout(o._timers[o._trackedFences[c].geofenceName]);i[u](o._trackedFences[c].geofenceName,o._trackedFences[c].objectId,t.latitude,t.longitude)}}else if(r){r.latitude=t.latitude;r.longitude=t.longitude;if(u==="onenter"){o._runFenceAction(u,o._trackedFences[c].geofenceName,r,a);if(d>-1){(function(e,t,n,r){return h(e,t,n,r)})(c,t,d,r)}else{o._runFenceAction("onstay",o._trackedFences[c].geofenceName,r,a)}}else{clearTimeout(o._timers[o._trackedFences[c].geofenceName]);o._runFenceAction(u,o._trackedFences[c].geofenceName,r,a)}}}}},_mobilecheck:function(){var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))){e=true}})(navigator.userAgent||navigator.vendor||window.opera);return e},_trackedFences:[],_lastResults:{},_startMonitoring:function(e,t,n){var r=this;var i=false;if(t instanceof GeoPoint){i=true}var s=this._getFences(e);for(var a=0;a<s.length;a++){if(!o(r._trackedFences,s[a],"geofenceName")){r._typesMapper[s[a].type](s[a],r);r._lastResults[s[a].geofenceName]=false;r._trackedFences.push(s[a])}else{}}function o(e,t,n){var r=e.length,i=false;for(var s=0;s<r;s++){if(i=e[s][n]===t[n]){break}}return i}function c(a){r._checkPosition(e,a.coords,s,i?t:null,!i?t:null,r._lastResults,n)}function l(e){throw new Error("Error during current position calculation. Error "+e.message)}function u(){navigator.geolocation.getCurrentPosition(c,l,{timeout:5e3,enableHighAccuracy:true})}if(!this.monitoringId){if(s.length){this.monitoringId=!this._mobilecheck()?setInterval(u,r._maxDuration):navigator.geolocation.watchPosition(c,l,{timeout:r._maxDuration,enableHighAccuracy:true})}else{throw new Error("Please, add some fences to start monitoring")}}},startGeofenceMonitoringWithInAppCallback:promisified("_startGeofenceMonitoringWithInAppCallback"),startGeofenceMonitoringWithInAppCallbackSync:synchronized("_startGeofenceMonitoringWithInAppCallback"),_startGeofenceMonitoringWithInAppCallback:function(e,t,n){this._startMonitoring(e,t,n)},startGeofenceMonitoringWithRemoteCallback:promisified("_startGeofenceMonitoringWithRemoteCallback"),startGeofenceMonitoringWithRemoteCallbackSync:synchronized("_startGeofenceMonitoringWithRemoteCallback"),_startGeofenceMonitoringWithRemoteCallback:function(e,t,n){this._startMonitoring(e,t,n)},stopGeofenceMonitoring:function(e){var t=this;if(e){for(var n=0;n<t._trackedFences.length;n++){if(t._trackedFences[n].geofenceName==e){t._trackedFences.splice(n,1);delete t._lastResults[e]}}}else{this._lastResuls={};this._trackedFences=[]}if(!t._trackedFences.length){t.monitoringId=null;!t._mobilecheck()?clearInterval(t.monitoringId):navigator.geolocation.clearWatch(t.monitoringId)}}};function Proxy(){}Proxy.prototype={on:function(e,t){if(!e){throw new Error("Event name not specified")}if(!t){throw new Error("Handler not specified")}this.eventHandlers[e]=this.eventHandlers[e]||[];this.eventHandlers[e].push(t)},fireEvent:function(e,t){var n=this.eventHandlers[e]||[],r,i;for(i=0,r=n.length;i<r;++i){n[i](t)}}};function PollingProxy(e){this.eventHandlers={};this.restUrl=e;this.timer=0;this.timeout=0;this.interval=1e3;this.xhr=null;this.needReconnect=true;this.responder=new Async(this.onMessage,this.onError,this);this.poll()}PollingProxy.prototype=new Proxy;Utils.deepExtend(PollingProxy.prototype,{onMessage:function(e){clearTimeout(this.timeout);var t=this;this.timer=setTimeout(function(){t.poll()},this.interval);this.fireEvent("messageReceived",e)},poll:function(){var e=this;this.timeout=setTimeout(function(){e.onTimeout()},30*1e3);this.xhr=Backendless._ajax({method:"GET",url:this.restUrl,isAsync:true,asyncHandler:this.responder})},close:function(){clearTimeout(this.timer);clearTimeout(this.timeout);this.needReconnect=false;this.xhr&&this.xhr.abort()},onTimeout:function(){this.xhr&&this.xhr.abort()},onError:function(){clearTimeout(this.timer);clearTimeout(this.timeout);if(this.needReconnect){var e=this;this.xhr=null;this.timer=setTimeout(function(){e.poll()},this.interval)}}});function SocketProxy(e){var t=this;this.reconnectWithPolling=true;try{var n=this.socket=new WebSocket(e);n.onopen=function(){return t.sockOpen()};n.onerror=function(e){return t.sockError(e)};n.onclose=function(){t.onSocketClose()};n.onmessage=function(e){return t.onMessage(e)}}catch(e){setTimeout(function(){t.onSocketClose()},100)}}SocketProxy.prototype=new Proxy;Utils.deepExtend(SocketProxy.prototype,{onMessage:function(){this.fireEvent("messageReceived",data)},onSocketClose:function(e){if(this.reconnectWithPolling){this.fireEvent("socketClose",e)}},close:function(){this.reconnectWithPolling=false;this.socket.close()}});function Subscription(e){this.channelName=e.channelName;this.options=e.options;this.channelProperties=e.channelProperties;this.subscriptionId=null;this.restUrl=e.restUrl+"/"+e.channelName;this.responder=e.responder||emptyFn;this._subscribe(e.onSubscribe)}Subscription.prototype={_subscribe:function(e){var t=Utils.extractResponder(arguments);var n=t!=null;var r=this;var i=new Async(function(e){r.subscriptionId=e.subscriptionId;r._startSubscription()},function(e){t.fault(e)});var s=Backendless._ajax({method:"POST",url:this.restUrl+"/subscribe",isAsync:n,data:JSON.stringify(this.options),asyncHandler:i});if(!n){this.subscriptionId=s.subscriptionId;this._startSubscription()}},_startSubscription:function(){var e=this;if(WebSocket){var t=this.channelProperties["websocket"]+"/"+this.subscriptionId;this.proxy=new SocketProxy(t);this.proxy.on("socketClose",function(){e._switchToPolling()});this.proxy.on("messageReceived",function(){e.responder()})}else{this._switchToPolling()}this._startSubscription=emptyFn},cancelSubscription:function(){this.proxy&&this.proxy.close();this._startSubscription=emptyFn},_switchToPolling:function(){var e=this.restUrl+"/"+this.subscriptionId;this.proxy=new PollingProxy(e);var t=this;this.proxy.on("messageReceived",function(e){if(e.messages.length){t.responder(e)}})}};function Messaging(){this.restUrl=Backendless.appPath+"/messaging";this.channelProperties={}}Messaging.prototype={_getProperties:function(e,t){var n=Utils.extractResponder(arguments);var r=n!=null;var i=this.channelProperties[e];if(i){if(r){t.success(i)}return i}var s=Backendless._ajax({method:"GET",url:this.restUrl+"/"+e+"/properties",isAsync:r,asyncHandler:n});this.channelProperties[e]=s;return s},subscribe:promisified("_subscribe"),subscribeSync:synchronized("_subscribe"),_subscribe:function(e,t,n,r){var i=Utils.extractResponder(arguments);var s=i!=null;if(s){var a=this;var o=new Async(function(r){i.success(new Subscription({channelName:e,options:n,channelProperties:r,responder:t,restUrl:a.restUrl,onSubscribe:i}))},function(e){i.fault(e)});this._getProperties(e,o)}else{var c=this._getProperties(e);return new Subscription({channelName:e,options:n,channelProperties:c,responder:t,restUrl:this.restUrl})}},publish:promisified("_publish"),publishSync:synchronized("_publish"),_publish:function(e,t,n,r,i){var s=Utils.extractResponder(arguments);var a=s!=null;var o={message:t};if(n&&n!==s){if(!(n instanceof PublishOptions)){throw new Error("Use PublishOption as publishOptions argument")}Utils.deepExtend(o,n)}if(r&&r!==s){if(!(r instanceof DeliveryOptions)){throw new Error("Use DeliveryOptions as deliveryTarget argument")}Utils.deepExtend(o,r)}return Backendless._ajax({method:"POST",url:this.restUrl+"/"+e,isAsync:a,asyncHandler:s,data:JSON.stringify(o)})},sendEmail:promisified("_sendEmail"),sendEmailSync:synchronized("_sendEmail"),_sendEmail:function(e,t,n,r,i){var s=Utils.extractResponder(arguments);var a=s!=null;var o={};if(e&&!Utils.isEmpty(e)&&Utils.isString(e)){o.subject=e}else{throw new Error("Subject is required parameter and must be a nonempty string")}if(t instanceof Bodyparts&&!Utils.isEmpty(t)){o.bodyparts=t}else{throw new Error("Use Bodyparts as bodyParts argument, must contain at least one property")}if(n&&Utils.isArray(n)&&!Utils.isEmpty(n)){o.to=n}else{throw new Error("Recipients is required parameter, must be a nonempty array")}if(r){if(Utils.isArray(r)){if(!Utils.isEmpty(r)){o.attachment=r}}}function c(e){return e.status}return Backendless._ajax({method:"POST",url:this.restUrl+"/email",isAsync:a,asyncHandler:Utils.wrapAsync(s,c),data:JSON.stringify(o)})},cancel:promisified("_cancel"),cancelSync:synchronized("_cancel"),_cancel:function(e,t){var n=t!=null;return Backendless._ajax({method:"DELETE",url:this.restUrl+"/"+e,isAsync:n,asyncHandler:new Async(emptyFn)})},registerDevice:promisified("_registerDevice"),registerDeviceSync:synchronized("_registerDevice"),_registerDevice:function(e,t,n,r){assertDeviceDefined();var i=Utils.extractResponder(arguments);var s=i!=null;var a={deviceToken:e,deviceId:DEVICE.uuid,os:DEVICE.platform,osVersion:DEVICE.version};if(Utils.isArray(t)){a.channels=t}for(var o=0,c=arguments.length;o<c;++o){var l=arguments[o];if(Utils.isNumber(l)||l instanceof Date){a.expiration=l instanceof Date?l.getTime()/1e3:l}}Backendless._ajax({method:"POST",url:this.restUrl+"/registrations",data:JSON.stringify(a),isAsync:s,asyncHandler:i})},getRegistrations:promisified("_getRegistrations"),getRegistrationsSync:synchronized("_getRegistrations"),_getRegistrations:function(e){assertDeviceDefined();var t=Utils.extractResponder(arguments);var n=t!=null;return Backendless._ajax({method:"GET",url:this.restUrl+"/registrations/"+DEVICE.uuid,isAsync:n,asyncHandler:t})},unregisterDevice:promisified("_unregisterDevice"),unregisterDeviceSync:synchronized("_unregisterDevice"),_unregisterDevice:function(e){assertDeviceDefined();var t=Utils.extractResponder(arguments);var n=t!=null;Backendless._ajax({method:"DELETE",url:this.restUrl+"/registrations/"+DEVICE.uuid,isAsync:n,asyncHandler:t})},getMessageStatus:promisified("_getMessageStatus"),getMessageStatusSync:synchronized("_getMessageStatus"),_getMessageStatus:function(e,t){if(!e){throw Error("Message ID is required.")}var n=Utils.extractResponder(arguments);return Backendless._ajax({method:"GET",url:this.restUrl+"/"+e,isAsync:!!n,asyncHandler:n})}};function getBuilder(e,t,n){var r="--",i="\r\n",s="";s+=r;s+=n;s+=i;s+='Content-Disposition: form-data; name="file"';s+='; filename="'+e+'"';s+=i;s+="Content-Type: application/octet-stream";s+=i;s+=i;s+=t;s+=i;s+=r;s+=n;s+=r;s+=i;return s}function sendData(e){var t=e.async;var n=e.encoded;var r="-backendless-multipart-form-boundary-"+getNow();var i=new Backendless.XMLHttpRequest;var s=function(e){var t={};try{t=JSON.parse(e.responseText)}catch(n){t.message=e.responseText}t.statusCode=e.status;return t};i.open(e.method,e.url,!!t);if(n){i.setRequestHeader("Content-Type","text/plain")}else{i.setRequestHeader("content-type","multipart/form-data; boundary="+r)}if(UIState!==null){i.setRequestHeader("uiState",UIState)}var a=currentUser&&currentUser["user-token"]||Backendless.LocalCache.get("user-token");if(a){i.setRequestHeader("user-token",a)}if(t){i.onreadystatechange=function(){if(i.readyState===4&&i.status){if(i.status>=200&&i.status<300){t.success(JSON.parse(i.responseText))}else{t.fault(JSON.parse(i.responseText))}}};i.onerror=Utils.onHttpRequestErrorHandler(i,t.fault,s)}i.send(n?e.data:Utils.stringToBiteArray(getBuilder(e.fileName,e.data,r)));if(t){return i}if(i.status>=200&&i.status<300){return i.responseText?JSON.parse(i.responseText):true}else{throw s(i)}}function FilePermissions(){this.READ=new FilePermission("READ");this.DELETE=new FilePermission("DELETE");this.WRITE=new FilePermission("WRITE")}function FilePermission(e){this.permission=e;this.restUrl=Backendless.appPath+"/files/permissions"}FilePermission.prototype={grantUser:promisified("_grantUser"),grantUserSync:synchronized("_grantUser"),_grantUser:function(e,t,n){return this._sendRequest({varType:"user",id:e,url:t,state:"GRANT",responder:n})},grantRole:promisified("_grantRole"),grantRoleSync:synchronized("_grantRole"),_grantRole:function(e,t,n){return this._sendRequest({varType:"role",id:e,url:t,state:"GRANT",responder:n})},grant:promisified("_grant"),grantSync:synchronized("_grant"),_grant:function(e,t){return this._sendRequest({varType:"user",url:e,state:"GRANT",responder:t})},denyUser:promisified("_denyUser"),denyUserSync:synchronized("_denyUser"),_denyUser:function(e,t,n){return this._sendRequest({varType:"user",id:e,url:t,state:"DENY",responder:n})},denyRole:promisified("_denyRole"),denyRoleSync:synchronized("_denyRole"),_denyRole:function(e,t,n){return this._sendRequest({varType:"role",id:e,url:t,state:"DENY",responder:n})},deny:promisified("_deny"),denySync:synchronized("_deny"),_deny:function(e,t){return this._sendRequest({varType:"user",url:e,state:"DENY",responder:t})},_sendRequest:function(e){var t=e.state;var n=e.url;var r=e.responder;var i=r!=null;var s={permission:this.permission};if(e.varType){s[e.varType]=e.id||"*"}return Backendless._ajax({method:"PUT",url:this.restUrl+"/"+t+"/"+encodeURIComponent(n),data:JSON.stringify(s),isAsync:i,asyncHandler:r})}};function Files(){this.restUrl=Backendless.appPath+"/files"}Files.prototype={saveFile:promisified("_saveFile"),saveFileSync:synchronized("_saveFile"),_saveFile:function(e,t,n,r,i){if(!e||!Utils.isString(e)){throw new Error('Missing value for the "path" argument. The argument must contain a string value')}if(!t||!Utils.isString(e)){throw new Error('Missing value for the "fileName" argument. The argument must contain a string value')}if(r instanceof Async){i=r;r=null}if(typeof File!=="undefined"&&!(n instanceof File)){n=new Blob([n])}if(n.size>28e5){throw new Error("File Content size must be less than 2,800,000 bytes")}var s=this.restUrl+"/binary/"+e+(Utils.isString(t)?"/"+t:"");if(r){s+="?overwrite=true"}t=encodeURIComponent(t).replace(/'/g,"%27").replace(/"/g,"%22");function a(e){sendData({url:s,data:e,fileName:t,encoded:true,async:i,method:"PUT"})}if(typeof Blob!=="undefined"&&n instanceof Blob){var o=new FileReader;o.fileName=t;o.onloadend=function(e){a(e.target.result.split(",")[1])};o.onerror=function(e){i.fault(e)};o.readAsDataURL(n)}else{a(n)}if(!i){return true}},upload:promisified("_upload"),uploadSync:synchronized("_upload"),_upload:function(e,t,n,r){r=Utils.extractResponder(arguments);e=e.files||e;var i=this.restUrl+"/"+t+"/";var s="";if(Utils.isBoolean(n)){s="?overwrite="+n}if(isBrowser){if(window.File&&window.FileList){if(e instanceof File){e=[e]}var a=0;for(var o=0,c=e.length;o<c;o++){try{var l=new FileReader;var u=encodeURIComponent(e[o].name).replace(/'/g,"%27").replace(/"/g,"%22");var d=i+u+s;l.fileName=u;l.onloadend=function(e){sendData({url:d,data:e.target.result,fileName:u,async:r,method:"POST"})};l.onerror=function(e){r.fault(e)};l.readAsBinaryString(e[o])}catch(e){a++}}}else{var f=document.createElement("iframe");f.id=f.name="ifr"+getNow();f.width=f.height="0";document.body.appendChild(f);var h=document.createElement("form");h.target=f.name;h.enctype="multipart/form-data";h.method="POST";document.body.appendChild(h);h.appendChild(e);var u=encodeURIComponent(e.value).replace(/'/g,"%27").replace(/"/g,"%22"),p=u.lastIndexOf("\\");if(p){u=u.substring(p+1)}h.action=i+u+s;h.submit()}}else{throw new Error("Upload File not supported with NodeJS")}},listing:promisified("_listing"),listingSync:synchronized("_listing"),_listing:function(e,t,n,r,i,s){var a=Utils.extractResponder(arguments),o=a!=null,c=this.restUrl+"/"+e;if(arguments.length>1&&!(arguments[1]instanceof Async)){c+="?"}if(Utils.isString(t)){c+="pattern="+t}if(Utils.isBoolean(n)){c+="&sub="+n}if(Utils.isNumber(r)){c+="&pagesize="+r}if(Utils.isNumber(i)){c+="&offset="+i}return Backendless._ajax({method:"GET",url:c,isAsync:o,asyncHandler:a})},renameFile:promisified("_renameFile"),renameFileSync:synchronized("_renameFile"),_renameFile:function(e,t,n){this._checkPath(e);var r={oldPathName:e,newName:t};return this._doAction("rename",r,n)},moveFile:promisified("_moveFile"),moveFileSync:synchronized("_moveFile"),_moveFile:function(e,t,n){this._checkPath(e);this._checkPath(t);var r={sourcePath:e,targetPath:t};return this._doAction("move",r,n)},copyFile:promisified("_copyFile"),copyFileSync:synchronized("_copyFile"),_copyFile:function(e,t,n){this._checkPath(e);this._checkPath(t);var r={sourcePath:e,targetPath:t};return this._doAction("copy",r,n)},_checkPath:function(e){if(!/^\//.test(e)){e="/"+e}return e},_doAction:function(e,t,n){var r=Utils.extractResponder(arguments);var i=!!r;return Backendless._ajax({method:"PUT",url:this.restUrl+"/"+e,data:JSON.stringify(t),isAsync:i,asyncHandler:r})},remove:promisified("_remove"),removeSync:synchronized("_remove"),_remove:function(e,t){var n=Utils.extractResponder(arguments);var r=n!=null;var i=e.indexOf("http://")===0||e.indexOf("https://")===0?e:this.restUrl+"/"+e;Backendless._ajax({method:"DELETE",url:i,isAsync:r,asyncHandler:n})},exists:promisified("_exists"),existsSync:synchronized("_exists"),_exists:function(e,t){if(!e||!Utils.isString(e)){throw new Error('Missing value for the "path" argument. The argument must contain a string value')}var n=Utils.extractResponder(arguments),r=n!=null,i=this.restUrl+"/"+e+"?action=exists";return Backendless._ajax({method:"GET",url:i,isAsync:r,asyncHandler:n})},removeDirectory:promisified("_removeDirectory"),removeDirectorySync:synchronized("_removeDirectory"),_removeDirectory:function(e,t){var n=Utils.extractResponder(arguments);var r=n!=null;return Backendless._ajax({method:"DELETE",url:this.restUrl+"/"+e,isAsync:r,asyncHandler:n})},getFileCount:promisified("_getFileCount"),getFileCountSync:synchronized("_getFileCount"),_getFileCount:function(e,t,n,r,i){var s=Utils.extractResponder(arguments);var a=!!s;var o=this._buildCountQueryObject(arguments,a);this._validateCountQueryObject(o);delete o.path;var c=this.restUrl+"/"+e+"?"+Utils.toQueryParams(o);return Backendless._ajax({method:"GET",url:c,isAsync:a,asyncHandler:s})},_buildCountQueryObject:function(e,t){e=t?Array.prototype.slice.call(e,0,-1):e;return{action:"count",path:e[0],pattern:e[1]!==undefined?e[1]:"*",recursive:e[2]!==undefined?e[2]:false,countDirectories:e[3]!==undefined?e[3]:false}},_validateCountQueryObject:function(e){if(!e.path||!Utils.isString(e.path)){throw new Error('Missing value for the "path" argument. The argument must contain a string value')}if(!e.pattern||!Utils.isString(e.pattern)){throw new Error('Missing value for the "pattern" argument. The argument must contain a string value')}if(!Utils.isBoolean(e.recursive)){throw new Error('Missing value for the "recursive" argument. The argument must contain a boolean value')}if(!Utils.isBoolean(e.countDirectories)){throw new Error('Missing value for the "countDirectories" argument. The argument must contain a boolean value')}}};function Commerce(){this.restUrl=Backendless.appPath+"/commerce/googleplay"}Commerce.prototype={validatePlayPurchase:promisified("_validatePlayPurchase"),validatePlayPurchaseSync:synchronized("_validatePlayPurchase"),_validatePlayPurchase:function(e,t,n,r){if(arguments.length<3){throw new Error("Package Name, Product Id, Token must be provided and must be not an empty STRING!")}for(var i=arguments.length-2;i>=0;i--){if(!arguments[i]||!Utils.isString(arguments[i])){throw new Error("Package Name, Product Id, Token must be provided and must be not an empty STRING!")}}var s=Utils.extractResponder(arguments),a=s!=null;if(s){s=Utils.wrapAsync(s)}return Backendless._ajax({method:"GET",url:this.restUrl+"/validate/"+e+"/inapp/"+t+"/purchases/"+n,isAsync:a,asyncHandler:s})},cancelPlaySubscription:promisified("_cancelPlaySubscription"),cancelPlaySubscriptionSync:synchronized("_cancelPlaySubscription"),_cancelPlaySubscription:function(e,t,n,r){if(arguments.length<3){throw new Error("Package Name, Subscription Id, Token must be provided and must be not an empty STRING!")}for(var i=arguments.length-2;i>=0;i--){if(!arguments[i]||!Utils.isString(arguments[i])){throw new Error("Package Name, Subscription Id, Token must be provided and must be not an empty STRING!")}}var s=Utils.extractResponder(arguments),a=s!=null;if(s){s=Utils.wrapAsync(s)}return Backendless._ajax({method:"POST",url:this.restUrl+"/"+e+"/subscription/"+t+"/purchases/"+n+"/cancel",isAsync:a,asyncHandler:s})},getPlaySubscriptionStatus:promisified("_getPlaySubscriptionStatus"),getPlaySubscriptionStatusSync:synchronized("_getPlaySubscriptionStatus"),_getPlaySubscriptionStatus:function(e,t,n,r){if(arguments.length<3){throw new Error("Package Name, Subscription Id, Token must be provided and must be not an empty STRING!")}for(var i=arguments.length-2;i>=0;i--){if(!arguments[i]||!Utils.isString(arguments[i])){throw new Error("Package Name, Subscription Id, Token must be provided and must be not an empty STRING!")}}var s=Utils.extractResponder(arguments),a=s!=null;if(s){s=Utils.wrapAsync(s)}return Backendless._ajax({method:"GET",url:this.restUrl+"/"+e+"/subscription/"+t+"/purchases/"+n,isAsync:a,asyncHandler:s})}};function Events(){this.restUrl=Backendless.appPath+"/servercode/events"}Events.prototype={dispatch:promisified("_dispatch"),dispatchSync:synchronized("_dispatch"),_dispatch:function(e,t){if(!e||!Utils.isString(e)){throw new Error("Event Name must be provided and must be not an empty STRING!")}t=Utils.isObject(t)&&!(t instanceof Async)?t:{};var n=Utils.extractResponder(arguments);if(n){n=Utils.wrapAsync(n)}t=t instanceof Async?{}:t;return Backendless._ajax({method:"POST",url:this.restUrl+"/"+e,data:JSON.stringify(t),isAsync:n!=null,asyncHandler:n})}};var Cache=function(){this.restUrl=Backendless.appPath+"/cache/"};var FactoryMethods={};Cache.prototype={put:promisified("_put"),putSync:synchronized("_put"),_put:function(e,t,n,r){if(!Utils.isString(e)){throw new Error("You can use only String as key to put into Cache")}if(!(n instanceof Async)){if(typeof n==="object"&&!arguments[3]){r=n;n=null}else if(typeof n!==("number"||"string")&&n!=null){throw new Error("You can use only String as timeToLive attribute to put into Cache")}}else{r=n;n=null}if(Utils.isObject(t)&&t.constructor!==Object){t.___class=t.___class||Utils.getClassName(t)}var i=Utils.extractResponder([r]),s=false;if(i!=null){s=true;i=Utils.wrapAsync(i)}return Backendless._ajax({method:"PUT",url:this.restUrl+e+(n?"?timeout="+n:""),data:JSON.stringify(t),isAsync:s,asyncHandler:i})},expireIn:promisified("_expireIn"),expireInSync:synchronized("_expireIn"),_expireIn:function(e,t,n){if(Utils.isString(e)&&(Utils.isNumber(t)||Utils.isDate(t))&&t){t=Utils.isDate(t)?t.getTime():t;var r=Utils.extractResponder(arguments),i=false;if(r!=null){i=true;r=Utils.wrapAsync(r)}return Backendless._ajax({method:"PUT",url:this.restUrl+e+"/expireIn?timeout="+t,data:JSON.stringify({}),isAsync:i,asyncHandler:r})}else{throw new Error('The "key" argument must be String. The "seconds" argument can be either Number or Date')}},expireAt:promisified("_expireAt"),expireAtSync:synchronized("_expireAt"),_expireAt:function(e,t,n){if(Utils.isString(e)&&(Utils.isNumber(t)||Utils.isDate(t))&&t){t=Utils.isDate(t)?t.getTime():t;var r=Utils.extractResponder(arguments),i=false;if(r!=null){i=true;r=Utils.wrapAsync(r)}return Backendless._ajax({method:"PUT",url:this.restUrl+e+"/expireAt?timestamp="+t,data:JSON.stringify({}),isAsync:i,asyncHandler:r})}else{throw new Error("You can use only String as key while expire in Cache. Second attribute must be declared and must be a Number or Date type")}},_cacheMethod:function(e,t,n,r){if(!Utils.isString(t)){throw new Error('The "key" argument must be String')}var i=Utils.extractResponder(arguments),s=false;if(i!=null){s=true;i=Utils.wrapAsync(i)}return Backendless._ajax({method:e,url:this.restUrl+t+(n?"/check":""),isAsync:s,asyncHandler:i})},contains:promisified("_contains"),containsSync:synchronized("_contains"),_contains:function(e,t){return this._cacheMethod("GET",e,true,t)},get:promisified("_get"),getSync:synchronized("_get"),_get:function(e,t){if(!Utils.isString(e)){throw new Error('The "key" argument must be String')}function n(e){var t=e&&e.___class;if(t){var n=FactoryMethods[t]||root[t];if(n){e=new n(e)}}return e}var r=Utils.extractResponder(arguments),i=false;if(r!=null){i=true;r=Utils.wrapAsync(r,n,this)}var s=Backendless._ajax({method:"GET",url:this.restUrl+e,isAsync:i,asyncHandler:r});return i?s:n(s)},remove:promisified("_remove"),removeSync:synchronized("_remove"),_remove:function(e,t){return this._cacheMethod("DELETE",e,false,t)},setObjectFactory:function(e,t){FactoryMethods[e]=t}};var Counter=function(e,t){this._nameValidation(e);this.restUrl=t;this.name=e};Counter.prototype={_nameValidation:function(e){if(!e){throw new Error('Missing value for the "counterName" argument. The argument must contain a string value.')}if(!Utils.isString(e)){throw new Error('Invalid value for the "value" argument. The argument must contain only string values')}},_implementMethod:function(e,t,n){var r=Utils.extractResponder(arguments);if(r!=null){r=Utils.wrapAsync(r)}return Backendless._ajax({method:e,url:this.restUrl+this.name+t,isAsync:!!r,asyncHandler:r})},_implementMethodWithValue:function(e,t,n){if(!t){throw new Error('Missing value for the "value" argument. The argument must contain a numeric value.')}if(!Utils.isNumber(t)){throw new Error('Invalid value for the "value" argument. The argument must contain only numeric values')}var r=Utils.extractResponder(arguments),i=false;if(r!=null){i=true;r=Utils.wrapAsync(r)}return Backendless._ajax({method:"PUT",url:this.restUrl+this.name+e+(t?t:""),isAsync:i,asyncHandler:r})},incrementAndGet:promisified("_incrementAndGet"),incrementAndGetSync:synchronized("_incrementAndGet"),_incrementAndGet:function(e){return this._implementMethod("PUT","/increment/get",e)},getAndIncrement:promisified("_getAndIncrement"),getAndIncrementSync:synchronized("_getAndIncrement"),_getAndIncrement:function(e){return this._implementMethod("PUT","/get/increment",e)},decrementAndGet:promisified("_decrementAndGet"),decrementAndGetSync:synchronized("_decrementAndGet"),_decrementAndGet:function(e){return this._implementMethod("PUT","/decrement/get",e)},getAndDecrement:promisified("_getAndDecrement"),getAndDecrementSync:synchronized("_getAndDecrement"),_getAndDecrement:function(e){return this._implementMethod("PUT","/get/decrement",e)},reset:promisified("_reset"),resetSync:synchronized("_reset"),_reset:function(e){return this._implementMethod("PUT","/reset",e)},get:promisified("_get"),getSync:synchronized("_get"),_get:function(e){var t=Utils.extractResponder(arguments),n=false;if(t!=null){n=true;t=Utils.wrapAsync(t)}return Backendless._ajax({method:"GET",url:this.restUrl+this.name,isAsync:n,asyncHandler:t})},addAndGet:promisified("_addAndGet"),addAndGetSync:synchronized("_addAndGet"),_addAndGet:function(e,t){return this._implementMethodWithValue("/incrementby/get?value=",e,t)},getAndAdd:promisified("_getAndAdd"),getAndAddSync:synchronized("_getAndAdd"),_getAndAdd:function(e,t){return this._implementMethodWithValue("/get/incrementby?value=",e,t)},compareAndSet:promisified("_compareAndSet"),compareAndSetSync:synchronized("_compareAndSet"),_compareAndSet:function(e,t,n){if(null==e||null==t){throw new Error('Missing values for the "expected" and/or "updated" arguments. The arguments must contain numeric values')}if(!Utils.isNumber(e)||!Utils.isNumber(t)){throw new Error('Missing value for the "expected" and/or "updated" arguments. The arguments must contain a numeric value')}var r=Utils.extractResponder(arguments),i=false;if(r!=null){i=true;r=Utils.wrapAsync(r)}return Backendless._ajax({method:"PUT",url:this.restUrl+this.name+"/get/compareandset?expected="+e+"&updatedvalue="+t,isAsync:i,asyncHandler:r})}};var Counters=function(){this.restUrl=Backendless.appPath+"/counters/"};Counters.prototype={of:function(e){return new Counter(e,this.restUrl)}};for(var methodName in Counter.prototype){if(Counter.prototype.hasOwnProperty(methodName)&&methodName[0]!=="_"){Counters.prototype[methodName]=createCounterMethodInvoker(methodName)}}function createCounterMethodInvoker(e){return function(t){var n=this.of(t);var r=Array.prototype.slice.call(arguments,1);return n[e].apply(n,r)}}var lastFlushListeners;Backendless.Logging={restUrl:root.url,loggers:{},logInfo:[],messagesCount:0,numOfMessages:10,timeFrequency:1,getLogger:function(e){if(!Utils.isString(e)){throw new Error("Invalid 'loggerName' value. LoggerName must be a string value")}if(!this.loggers[e]){this.loggers[e]=new Logging(e)}return this.loggers[e]},flush:promisified("_flush"),flushSync:synchronized("_flush"),_flush:function(){var e=Utils.extractResponder(arguments);if(this.logInfo.length){this.flushInterval&&clearTimeout(this.flushInterval);var t;var n=function(e){return function(){for(var n=0;n<t.length;n++){t[n][e].apply(null,arguments)}if(t===lastFlushListeners){lastFlushListeners=null}}};if(e){t=lastFlushListeners=lastFlushListeners?lastFlushListeners.splice(0):[];t.push(e)}Backendless._ajax({method:"PUT",isAsync:!!e,asyncHandler:e&&new Async(n("success"),n("fault")),url:Backendless.appPath+"/log",data:JSON.stringify(this.logInfo)});this.logInfo=[];this.messagesCount=0}else if(e){if(lastFlushListeners){lastFlushListeners.push(e)}else{setTimeout(e.success,0)}}},sendRequest:function(){var e=this;this.flushInterval=setTimeout(function(){e.flush()},this.timeFrequency*1e3)},checkMessagesLen:function(){if(this.messagesCount>this.numOfMessages-1){this.sendRequest()}},setLogReportingPolicy:function(e,t){this.numOfMessages=e;this.timeFrequency=t;this.checkMessagesLen()}};function Logging(e){this.name=e}function setLogMessage(e,t,n,r){var i={};i["message"]=n;i["timestamp"]=Date.now();i["exception"]=r?r:null;i["logger"]=e;i["log-level"]=t;Backendless.Logging.logInfo.push(i);Backendless.Logging.messagesCount++;Backendless.Logging.checkMessagesLen()}Logging.prototype={debug:function(e){return setLogMessage(this.name,"DEBUG",e)},info:function(e){return setLogMessage(this.name,"INFO",e)},warn:function(e,t){return setLogMessage(this.name,"WARN",e,t)},error:function(e,t){return setLogMessage(this.name,"ERROR",e,t)},fatal:function(e,t){return setLogMessage(this.name,"FATAL",e,t)},trace:function(e){return setLogMessage(this.name,"TRACE",e)}};function CustomServices(){this.restUrl=Backendless.appPath+"/services/"}CustomServices.prototype={invoke:promisified("_invoke"),invokeSync:synchronized("_invoke"),_invoke:function(e,t,n,r){var i=Utils.extractResponder(arguments);var s=i!=null;return Backendless._ajax({method:"POST",url:this.restUrl+[e,t].join("/"),data:JSON.stringify(n),isAsync:s,asyncHandler:i})}};function promisified(e){return function(){var t=[].slice.call(arguments);var n=this;var r=n[e];return new Promise(function(e,i){t.push(new Async(e,i,n));r.apply(n,t)})}}function synchronized(e){return function(){console.warn("Using of sync methods is an outdated approach. Please, use async methods.");var t=this;var n=t[e];return n.apply(t,arguments)}}function assertDeviceDefined(){if(!DEVICE){throw new Error("Device is not defined. Please, run the Backendless.setupDevice")}}Backendless.initApp=function(e,t){Backendless.applicationId=e;Backendless.secretKey=t;Backendless.appPath=[Backendless.serverURL,e,t].join("/");Backendless.UserService=new UserService;Backendless.Users=Backendless.UserService;Backendless.Geo=new Geo;Backendless.Persistence=persistence;Backendless.Data=persistence;Backendless.Data.Permissions=new DataPermissions;Backendless.Messaging=new Messaging;Backendless.Files=new Files;Backendless.Files.Permissions=new FilePermissions;Backendless.Commerce=new Commerce;Backendless.Events=new Events;Backendless.Cache=new Cache;Backendless.Counters=new Counters;Backendless.CustomServices=new CustomServices;dataStoreCache={};currentUser=null};Backendless.setupDevice=function(e){if(!e||!e.uuid||!e.platform||!e.version){throw new Error('Device properties object must consist of fields "uuid", "platform" and "version".')}DEVICE={uuid:e.uuid,platform:e.platform.toUpperCase(),version:e.version}};var DataQuery=function(e){e=e||{};this.properties=e.properties||[];this.condition=e.condition||null;this.options=e.options||null;this.url=e.url||null};DataQuery.prototype={addProperty:function(e){this.properties=this.properties||[];this.properties.push(e)},setOption:function(e,t){this.options=this.options||{};this.options[e]=t},setOptions:function(e){for(var t in e){if(e.hasOwnProperty(t)){this.setOption(t,e[t])}}},getOption:function(e){return this.options&&this.options[e]}};var PAGING_DEFAULTS={pageSize:10,offset:0};var PagingQueryBuilder=function(){this.offset=PAGING_DEFAULTS.offset;this.pageSize=PAGING_DEFAULTS.pageSize};PagingQueryBuilder.prototype={setPageSize:function(e){if(e<=0){return"Page size must be a positive value."}this.pageSize=e;return this},setOffset:function(e){if(e<0){throw new Error("Offset cannot have a negative value.")}this.offset=e;return this},prepareNextPage:function(){this.setOffset(this.offset+this.pageSize);return this},preparePreviousPage:function(){var e=this.offset>this.pageSize?this.offset-this.pageSize:0;this.setOffset(e);return this},build:function(){return{pageSize:this.pageSize,offset:this.offset}}};var DataQueryBuilder=function(){this._query=new DataQuery;this._paging=new PagingQueryBuilder};DataQueryBuilder.create=function(){return new DataQueryBuilder};DataQueryBuilder.prototype={setPageSize:function(e){this._paging.setPageSize(e);return this},setOffset:function(e){this._paging.setOffset(e);return this},prepareNextPage:function(){this._paging.prepareNextPage();return this},preparePreviousPage:function(){this._paging.preparePreviousPage();return this},getProperties:function(){return this._query.properties},setProperties:function(e){this._query.properties=Utils.castArray(e);return this},addProperty:function(e){this._query.addProperty(e);return this},getWhereClause:function(){return this._query.condition},setWhereClause:function(e){this._query.condition=e;return this},getSortBy:function(){return this._query.getOption("sortBy")},setSortBy:function(e){this._query.setOption("sortBy",Utils.castArray(e));return this},getRelated:function(){return this._query.getOption("relations")},setRelated:function(e){this._query.setOption("relations",Utils.castArray(e));return this},getRelationsDepth:function(){return this._query.getOption("relationsDepth")},setRelationsDepth:function(e){this._query.setOption("relationsDepth",e);return this},build:function(){this._query.setOptions(this._paging.build());return this._query}};var LoadRelationsQueryBuilder=function(e){this._query=new DataQuery;this._query.relationModel=e;this._paging=new PagingQueryBuilder};LoadRelationsQueryBuilder.create=function(){return new LoadRelationsQueryBuilder};LoadRelationsQueryBuilder.of=function(e){return new LoadRelationsQueryBuilder(e)};LoadRelationsQueryBuilder.prototype={setRelationName:function(e){this._query.setOption("relationName",e);return this},setPageSize:function(e){this._paging.setPageSize(e);return this},setOffset:function(e){this._paging.setOffset(e);return this},prepareNextPage:function(){this._paging.prepareNextPage();return this},preparePreviousPage:function(){this._paging.preparePreviousPage();return this},setWhereClause:function(e){this._query.condition=e;return this},build:function(){this._query.setOptions(this._paging.build());return this._query}};var GeoQuery=function(e){e=e||{};this.searchRectangle=e.searchRectangle||undefined;this.categories=e.categories||[];this.includeMetadata=e.includeMetadata||true;this.metadata=e.metadata||undefined;this.condition=e.condition||undefined;this.relativeFindMetadata=e.relativeFindMetadata||undefined;this.relativeFindPercentThreshold=e.relativeFindPercentThreshold||undefined;this.pageSize=e.pageSize||undefined;this.latitude=e.latitude||undefined;this.longitude=e.longitude||undefined;this.radius=e.radius||undefined;this.units=e.units||undefined;this.degreePerPixel=e.degreePerPixel||undefined;this.clusterGridSize=e.clusterGridSize||undefined};GeoQuery.prototype={addCategory:function(){this.categories=this.categories||[];this.categories.push()},setClusteringParams:function(e,t,n,r){r=r||0;var i=parseFloat(e),s=parseFloat(t),a=parseInt(n),o=parseInt(r);if(!isFinite(i)||i<-180||i>180){throw new Error("The westLongitude value must be a number in the range between -180 and 180")}if(!isFinite(s)||s<-180||s>180){throw new Error("The eastLongitude value must be a number in the range between -180 and 180")}if(!isFinite(a)||a<1){throw new Error("The mapWidth value must be a number greater or equal to 1")}if(!isFinite(o)||o<0){throw new Error("The clusterGridSize value must be a number greater or equal to 0")}var c=s-i;c<0&&(c+=360);this.degreePerPixel=c/a;this.clusterGridSize=o||null}};var GeoPoint=function(e){e=e||{};this.___class="GeoPoint";this.categories=e.categories;this.latitude=e.latitude;this.longitude=e.longitude;this.metadata=e.metadata;this.objectId=e.objectId;this.distance=e.distance};var GeoCluster=function(e){e=e||{};this.categories=e.categories;this.latitude=e.latitude;this.longitude=e.longitude;this.metadata=e.metadata;this.objectId=e.objectId;this.totalPoints=e.totalPoints;this.geoQuery=e.geoQuery;this.distance=e.distance};var PublishOptionsHeaders={MESSAGE_TAG:"message",IOS_ALERT_TAG:"ios-alert",IOS_BADGE_TAG:"ios-badge",IOS_SOUND_TAG:"ios-sound",ANDROID_TICKER_TEXT_TAG:"android-ticker-text",ANDROID_CONTENT_TITLE_TAG:"android-content-title",ANDROID_CONTENT_TEXT_TAG:"android-content-text",ANDROID_ACTION_TAG:"android-action",WP_TYPE_TAG:"wp-type",WP_TITLE_TAG:"wp-title",WP_TOAST_SUBTITLE_TAG:"wp-subtitle",WP_TOAST_PARAMETER_TAG:"wp-parameter",WP_TILE_BACKGROUND_IMAGE:"wp-backgroundImage",WP_TILE_COUNT:"wp-count",WP_TILE_BACK_TITLE:"wp-backTitle",WP_TILE_BACK_BACKGROUND_IMAGE:"wp-backImage",WP_TILE_BACK_CONTENT:"wp-backContent",WP_RAW_DATA:"wp-raw"};var PublishOptions=function(e){e=e||{};this.publisherId=e.publisherId||undefined;this.headers=e.headers||undefined;this.subtopic=e.subtopic||undefined};var DeliveryOptions=function(e){e=e||{};this.publishPolicy=e.publishPolicy||undefined;this.pushBroadcast=e.pushBroadcast||undefined;this.pushSinglecast=e.pushSinglecast||undefined;this.publishAt=e.publishAt||undefined;this.repeatEvery=e.repeatEvery||undefined;this.repeatExpiresAt=e.repeatExpiresAt||undefined};var Bodyparts=function(e){e=e||{};this.textmessage=e.textmessage||undefined;this.htmlmessage=e.htmlmessage||undefined};var SubscriptionOptions=function(e){e=e||{};this.subscriberId=e.subscriberId||undefined;this.subtopic=e.subtopic||undefined;this.selector=e.selector||undefined};Backendless.DataQueryBuilder=DataQueryBuilder;Backendless.LoadRelationsQueryBuilder=LoadRelationsQueryBuilder;Backendless.GeoQuery=GeoQuery;Backendless.GeoPoint=GeoPoint;Backendless.GeoCluster=GeoCluster;Backendless.Bodyparts=Bodyparts;Backendless.PublishOptions=PublishOptions;Backendless.DeliveryOptions=DeliveryOptions;Backendless.SubscriptionOptions=SubscriptionOptions;Backendless.PublishOptionsHeaders=PublishOptionsHeaders;try{root.GeoPoint=Backendless.GeoPoint;root.GeoCluster=Backendless.GeoCluster;root.BackendlessGeoQuery=Backendless.GeoQuery;root.Bodyparts=Backendless.Bodyparts;root.PublishOptions=Backendless.PublishOptions;root.DeliveryOptions=Backendless.DeliveryOptions;root.SubscriptionOptions=Backendless.SubscriptionOptions;root.PublishOptionsHeaders=Backendless.PublishOptionsHeaders}catch(e){console&&console.warn(e)}return Backendless});